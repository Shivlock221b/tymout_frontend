"use strict";(self.webpackChunktymout_frontend=self.webpackChunktymout_frontend||[]).push([[548],{1247:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(2768);const r="".concat("http://localhost:3000","/api/chats"),n=s.A.create({baseURL:r,withCredentials:!0}),i={getUserChats:async e=>{const{data:t}=await n.get("/user/".concat(e));return t},getChat:async e=>{const{data:t}=await n.get("/".concat(e));return t},getMessages:async function(e){let{limit:t=50,skip:a=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{data:s}=await n.get("/".concat(e,"/messages"),{params:{limit:t,skip:a}});return s},sendMessage:async e=>{const{data:t}=await n.post("/message",e);return t},markAsRead:async(e,t)=>{const{data:a}=await n.post("/".concat(e,"/read"),{userId:t});return a},getChatPreview:async(e,t)=>{const{data:a}=await n.get("/".concat(e,"/preview"),{params:{userId:t}});return a},updateChatStatus:async(e,t)=>{let{isBlocked:a,blockedBy:s}=t;const{data:r}=await n.patch("/".concat(e,"/status"),{isBlocked:a,blockedBy:s});return r},startDirectChat:async(e,t,a,s,r,i)=>{const{data:o}=await n.post("/direct",{userAId:e,userBId:t,userAName:a,userBName:s,userAAvatar:r,userBAvatar:i});return o}}},9548:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var s=a(9643),r=a(2218),n=a(7192),i=a(1078),o=a(1791),d=a(2053),l=a(6507);const c=e=>{let{thread:t,onClick:a}=e;const{name:s,avatar:n,lastMessage:c,timestamp:m,unread:g,online:h,tags:u}=t,x=new Date(m);let p;p=(0,i.A)(x)?(0,o.A)(x,"h:mm a"):(0,d.A)(x)?"Yesterday":(0,o.A)(x,"MMM d");const b=u&&u.length>0?u[0]:null;return(0,l.jsx)("div",{className:"p-3 cursor-pointer transition-all duration-300 hover:shadow-md rounded-xl m-2 bg-white border border-gray-100",onClick:a,children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,l.jsx)("img",{src:n||"https://via.placeholder.com/48?text=U",alt:"".concat(s,"'s avatar"),className:"w-12 h-12 rounded-lg object-cover shadow-sm border border-gray-200 bg-gray-50",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/48?text=U"}}),h&&(0,l.jsx)("span",{className:"absolute -bottom-1 -right-1 w-3.5 h-3.5 bg-green-500 rounded-full border-2 border-white"})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0 py-1",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:s}),(0,l.jsx)("span",{className:"text-xs text-gray-500 whitespace-nowrap ml-2",children:p})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600 line-clamp-1 mt-0.5",children:c}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[b&&(0,l.jsx)("span",{className:"inline-block px-2 py-0.5 text-xs rounded-full font-medium border ".concat((e=>({Events:"bg-blue-50 text-blue-700 border-blue-200",Circle:"bg-amber-50 text-amber-700 border-amber-200",Private:"bg-purple-50 text-purple-700 border-purple-200"}[e]||"bg-gray-50 text-gray-700 border-gray-200"))(b)),children:b}),g>0?(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(r.j1Q,{className:"text-indigo-500"}),(0,l.jsx)("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-indigo-600 text-xs font-medium text-white",children:g})]}):(0,l.jsx)("div",{className:"flex items-center gap-1 text-gray-400",children:(0,l.jsx)(r.j1Q,{})})]})]})]})})},m=e=>{let{threads:t}=e;const a=(0,n.Zp)();return(0,l.jsx)("div",{className:"divide-y",children:t.map((e=>(0,l.jsx)(c,{thread:e,onClick:()=>{return t=e.id,void a("/messages/".concat(t));var t}},e.id)))})},g=e=>{let{searchTerm:t,selectedTags:a,showTablePrompt:s}=e;const n=t&&""!==t.trim(),i=!0===a;return n&&i?(0,l.jsxs)("div",{className:"text-center py-16",children:[(0,l.jsx)(r.KSO,{className:"mx-auto text-gray-400 text-4xl mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No matching results"}),(0,l.jsxs)("p",{className:"text-gray-500",children:["We couldn't find any messages matching \"",t,'" with the selected tags']})]}):n?(0,l.jsxs)("div",{className:"text-center py-16",children:[(0,l.jsx)(r.KSO,{className:"mx-auto text-gray-400 text-4xl mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No results found"}),(0,l.jsxs)("p",{className:"text-gray-500",children:["We couldn't find any messages matching \"",t,'"']})]}):i?"Table"===s?(0,l.jsxs)("div",{className:"text-center py-16",children:[(0,l.jsx)(r.BuZ,{className:"mx-auto text-blue-400 text-4xl mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"No tables yet"}),(0,l.jsx)("p",{className:"text-blue-700",children:"Join your first table at Tymout or host your own table to start connecting with others!"})]}):"Circle"===s?(0,l.jsxs)("div",{className:"text-center py-16",children:[(0,l.jsx)(r.BuZ,{className:"mx-auto text-amber-400 text-4xl mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-amber-900 mb-2",children:"No circles yet"}),(0,l.jsx)("p",{className:"text-amber-700",children:"Join your first circle at Tymout or create your own circle to meet new people!"})]}):"Hostings"===s?(0,l.jsxs)("div",{className:"text-center py-16",children:[(0,l.jsx)(r.BuZ,{className:"mx-auto text-teal-400 text-4xl mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-teal-900 mb-2",children:"No hostings yet"}),(0,l.jsx)("p",{className:"text-teal-700",children:"Host your first event on Tymout!"})]}):(0,l.jsxs)("div",{className:"text-center py-16",children:[(0,l.jsx)(r.BuZ,{className:"mx-auto text-gray-400 text-4xl mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No messages with selected tags"}),(0,l.jsx)("p",{className:"text-gray-500",children:"Try selecting different tags or clear the filters"})]}):(0,l.jsxs)("div",{className:"text-center py-16",children:[(0,l.jsx)(r.opL,{className:"mx-auto text-gray-400 text-4xl mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No messages yet"}),(0,l.jsx)("p",{className:"text-gray-500",children:"When you connect with others, your conversations will appear here"})]})};g.defaultProps={searchTerm:"",selectedTags:!1,showTablePrompt:!1};const h=g,u=e=>{let{availableTags:t,selectedTag:a,onTagSelect:s,onClearFilter:r}=e;const n=e=>{const t=a===e,s={Table:{bg:t?"bg-blue-500":"bg-blue-50",text:t?"text-white":"text-blue-700",hover:"hover:bg-blue-100",border:t?"border-blue-500":"border-blue-200"},Circle:{bg:t?"bg-amber-500":"bg-amber-50",text:t?"text-white":"text-amber-700",hover:"hover:bg-amber-100",border:t?"border-amber-500":"border-amber-200"},Private:{bg:t?"bg-purple-500":"bg-purple-50",text:t?"text-white":"text-purple-700",hover:"hover:bg-purple-100",border:t?"border-purple-500":"border-purple-200"},Notification:{bg:t?"bg-green-500":"bg-green-50",text:t?"text-white":"text-green-700",hover:"hover:bg-green-100",border:t?"border-green-500":"border-green-200"},Hostings:{bg:t?"bg-teal-500":"bg-teal-50",text:t?"text-white":"text-teal-700",hover:"hover:bg-teal-100",border:t?"border-teal-500":"border-teal-200"},Archieve:{bg:t?"bg-gray-700":"bg-gray-100",text:t?"text-white":"text-gray-700",hover:"hover:bg-gray-200",border:t?"border-gray-700":"border-gray-200"}}[e]||{bg:t?"bg-gray-500":"bg-gray-50",text:t?"text-white":"text-gray-700",hover:"hover:bg-gray-100",border:t?"border-gray-500":"border-gray-200"};return"".concat(s.bg," ").concat(s.text," ").concat(t?"":s.hover," border ").concat(s.border)},i=Array.from(new Set(["Table","Circle","Hostings","Archieve",...t]));t.includes("Table");return(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("h2",{className:"text-sm font-medium text-gray-700",children:"Filter by category"}),a&&(0,l.jsx)("button",{onClick:r,className:"text-xs text-indigo-600 hover:text-indigo-800",children:"Clear filter"})]}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map((e=>(0,l.jsx)("button",{onClick:()=>s(e),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors duration-150 ".concat(n(e)),children:e},e)))})]})};u.defaultProps={selectedTag:null};const x=u;var p=a(5038),b=a(7109),v=a(1247),y=a(5432);const w=[{id:"thread1",name:"John Smith",avatar:"https://randomuser.me/api/portraits/men/32.jpg",lastMessage:"Hey, are you available for a call today?",timestamp:new Date(Date.now()-9e5).toISOString(),unread:2,online:!0,tags:["Private"]},{id:"thread2",name:"Sarah Johnson",avatar:"https://randomuser.me/api/portraits/women/44.jpg",lastMessage:"The documents have been sent to your email",timestamp:new Date(Date.now()-36e5).toISOString(),unread:0,online:!1,tags:["Work"]},{id:"thread3",name:"Tech Support",avatar:"https://randomuser.me/api/portraits/men/22.jpg",lastMessage:"Your ticket #45678 has been resolved",timestamp:new Date(Date.now()-108e5).toISOString(),unread:1,online:!0,tags:["Support"]},{id:"thread4",name:"Event Planning Team",avatar:"https://randomuser.me/api/portraits/women/28.jpg",lastMessage:"We need to finalize the venue by tomorrow",timestamp:new Date(Date.now()-864e5).toISOString(),unread:0,online:!1,tags:["Table"]},{id:"thread5",name:"David Wilson",avatar:"https://randomuser.me/api/portraits/men/42.jpg",lastMessage:"Looking forward to meeting you at the event!",timestamp:new Date(Date.now()-1728e5).toISOString(),unread:0,online:!0,tags:["Circle"]}],f={thread1:{id:"thread1",name:"John Smith",avatar:"https://randomuser.me/api/portraits/men/32.jpg",online:!0,messages:[{id:"msg1",threadId:"thread1",senderId:"john",senderName:"John Smith",content:"Hi there! How are you doing today?",timestamp:new Date(Date.now()-36e5).toISOString(),status:"read"},{id:"msg2",threadId:"thread1",senderId:"current_user",senderName:"You",content:"I'm doing well, thanks for asking! How about you?",timestamp:new Date(Date.now()-18e5).toISOString(),status:"read"},{id:"msg3",threadId:"thread1",senderId:"john",senderName:"John Smith",content:"Great! I was wondering if you're available for a call today?",timestamp:new Date(Date.now()-9e5).toISOString(),status:"delivered"},{id:"msg4",threadId:"thread1",senderId:"john",senderName:"John Smith",content:"I need to discuss some details about the project.",timestamp:new Date(Date.now()-84e4).toISOString(),status:"delivered"}]},thread2:{id:"thread2",name:"Sarah Johnson",avatar:"https://randomuser.me/api/portraits/women/44.jpg",online:!1,messages:[{id:"msg5",threadId:"thread2",senderId:"current_user",senderName:"You",content:"Hi Sarah, could you send me the documents we discussed yesterday?",timestamp:new Date(Date.now()-54e5).toISOString(),status:"read"},{id:"msg6",threadId:"thread2",senderId:"sarah",senderName:"Sarah Johnson",content:"Sure, I'll get those to you right away.",timestamp:new Date(Date.now()-42e5).toISOString(),status:"read"},{id:"msg7",threadId:"thread2",senderId:"sarah",senderName:"Sarah Johnson",content:"The documents have been sent to your email",timestamp:new Date(Date.now()-36e5).toISOString(),status:"read"}]}},S={getMessageThreads:async()=>{try{const e=y.n.getState().user;if(!e||!e._id)return w;const t=await v.A.getUserChats(e._id);return t&&Array.isArray(t)&&0!==t.length?t.map((t=>{var a,s;if(t.otherUser)return{id:t.chatId,name:t.otherUser.name||"User",avatar:t.otherUser.avatar||"https://via.placeholder.com/48?text=U",lastMessage:(null===(a=t.lastMessage)||void 0===a?void 0:a.text)||"No messages yet",timestamp:(null===(s=t.lastMessage)||void 0===s?void 0:s.timestamp)||t.lastActivity||(new Date).toISOString(),unread:t.unreadCount||0,online:!1,tags:["Private"]};{var r,n;const a=(null===(r=t.participants)||void 0===r?void 0:r.find((t=>t.userId!==e._id)))||(null===(n=t.participants)||void 0===n?void 0:n[0])||{},s=t.lastMessage||{};return{id:t.chatId||t._id,name:a.name||"User",avatar:a.avatar||"https://via.placeholder.com/48?text=U",lastMessage:s.text||"No messages yet",timestamp:s.timestamp||s.createdAt||(new Date).toISOString(),unread:t.unreadCount||0,online:a.online||!1,tags:["Private"]}}})):w}catch(e){return w}},getThreadMessages:async e=>{try{const t=y.n.getState().user;if(!t||!t._id)throw new Error("User not authenticated");const[a,s]=await Promise.all([v.A.getChat(e),v.A.getMessages(e)]),r=a.participants.find((e=>e.userId!==t._id))||a.participants[0]||{};return v.A.markAsRead(e,t._id).catch((e=>{})),{id:a.chatId||a._id,name:r.name||"User",avatar:r.avatar||"https://via.placeholder.com/48?text=U",online:r.online||!1,messages:s.map((t=>({id:t._id,threadId:e,senderId:t.senderId,senderName:t.senderName,content:t.text,timestamp:t.timestamp||t.createdAt,status:t.status||"sent"})))}}catch(t){const a=f[e];if(a)return a;throw t}},sendMessage:async(e,t)=>{try{const a=y.n.getState().user;if(!a||!a._id)throw new Error("User not authenticated");const s={chatId:e,senderId:a._id,senderName:a.name||a.username||"You",senderAvatar:a.profileImage||"",text:t,clientMsgId:"msg_".concat(Date.now())},r=await v.A.sendMessage(s);return{id:r._id,threadId:e,senderId:a._id,senderName:"You",content:r.text,timestamp:r.timestamp||r.createdAt,status:r.status||"sent"}}catch(a){throw a}},markThreadAsRead:async e=>{try{const t=y.n.getState().user;if(!t||!t._id)throw new Error("User not authenticated");const a=await v.A.markAsRead(e,t._id);return(0,p.A)({threadId:e,success:!0},a)}catch(t){throw t}},initializeWebSocket:(e,t,a)=>{const s={isConnected:!0,sendTypingStatus:(e,t)=>{},disconnect:()=>{s.isConnected=!1}};return s}};var N=a(5469),j=a(1899);const T=(0,N.v)((0,j.y)("messaging",((e,t)=>({activeThreadId:null,uiState:{isMessagePanelOpen:!1,showTagFilter:!0,isTyping:{},draft:{},searchTerm:"",selectedTag:"Table"},setActiveThreadId:t=>e({activeThreadId:t}),toggleMessagePanel:()=>e((e=>({uiState:(0,p.A)((0,p.A)({},e.uiState),{},{isMessagePanelOpen:!e.uiState.isMessagePanelOpen})}))),toggleTagFilter:()=>e((e=>({uiState:(0,p.A)((0,p.A)({},e.uiState),{},{showTagFilter:!e.uiState.showTagFilter})}))),setTypingStatus:(t,a)=>e((e=>({uiState:(0,p.A)((0,p.A)({},e.uiState),{},{isTyping:(0,p.A)((0,p.A)({},e.uiState.isTyping),{},{[t]:a})})}))),updateDraft:(t,a)=>e((e=>({uiState:(0,p.A)((0,p.A)({},e.uiState),{},{draft:(0,p.A)((0,p.A)({},e.uiState.draft),{},{[t]:a})})}))),clearDraft:t=>e((e=>{const a=(0,p.A)({},e.uiState.draft);return delete a[t],{uiState:(0,p.A)((0,p.A)({},e.uiState),{},{draft:a})}})),setSearchTerm:t=>e((e=>({uiState:(0,p.A)((0,p.A)({},e.uiState),{},{searchTerm:t})}))),setSelectedTag:t=>e((e=>({uiState:(0,p.A)((0,p.A)({},e.uiState),{},{selectedTag:t})}))),clearSelectedTag:()=>e((e=>({uiState:(0,p.A)((0,p.A)({},e.uiState),{},{selectedTag:null})})))})))),A=()=>{const{searchTerm:e,setSearchTerm:t,selectedTag:a,setSelectedTag:n,clearSelectedTag:i,showTagFilter:o}=(()=>{const e=T((e=>e.uiState.searchTerm)),t=T((e=>e.setSearchTerm)),a=T((e=>e.uiState.selectedTag)),r=T((e=>e.setSelectedTag)),n=T((e=>e.clearSelectedTag)),i=T((e=>e.uiState.showTagFilter)),o=T((e=>e.toggleTagFilter));return(0,s.useMemo)((()=>({searchTerm:e,setSearchTerm:t,selectedTag:a,setSelectedTag:r,clearSelectedTag:n,showTagFilter:i,toggleTagFilter:o})),[e,t,a,r,n,i,o])})(),d=(0,y.n)((e=>e.user)),[c,g]=(0,s.useState)([]),[u,w]=(0,s.useState)(!0),{data:f=[],isLoading:N}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,b.I)((0,p.A)({queryKey:["messageThreads"],queryFn:S.getMessageThreads,staleTime:3e4},e))}();(0,s.useEffect)((()=>{(async()=>{if(d&&d._id)try{w(!0);const e=await v.A.getUserChats(d._id);if(!e||!Array.isArray(e)||0===e.length)return g([]),void w(!1);const t=e.map((e=>{var t,a;if(e.otherUser)return{id:e.chatId,name:e.otherUser.name||"User",avatar:e.otherUser.avatar||"https://via.placeholder.com/48?text=U",lastMessage:(null===(t=e.lastMessage)||void 0===t?void 0:t.text)||"No messages yet",timestamp:(null===(a=e.lastMessage)||void 0===a?void 0:a.timestamp)||e.lastActivity||(new Date).toISOString(),unread:e.unreadCount||0,online:!1,tags:["Private"]};{var s,r;const t=(null===(s=e.participants)||void 0===s?void 0:s.find((e=>e.userId!==d._id)))||(null===(r=e.participants)||void 0===r?void 0:r[0])||{},a=e.lastMessage||{};return{id:e.chatId||e._id,name:t.name||"User",avatar:t.avatar||"https://via.placeholder.com/48?text=U",lastMessage:a.text||"No messages yet",timestamp:a.timestamp||a.createdAt||(new Date).toISOString(),unread:e.unreadCount||0,online:t.online||!1,tags:["Private"]}}}));g(t)}catch(e){g([])}finally{w(!1)}else w(!1)})()}),[d]);const j=c.length>0?c:f,A=u||N,I=(0,s.useMemo)((()=>{const e=j.filter((e=>e.tags&&Array.isArray(e.tags))).flatMap((e=>e.tags)),t=[...new Set(e)],a=["Table","Circle","Private","Notification","Hostings"];return t.sort(((e,t)=>{const s=a.indexOf(e),r=a.indexOf(t);return-1!==s&&-1!==r?s-r:-1!==s?-1:-1!==r?1:e.localeCompare(t)}))}),[j]),C=(0,s.useMemo)((()=>j.filter((t=>{const s=t.name.toLowerCase().includes(e.toLowerCase())||t.lastMessage.toLowerCase().includes(e.toLowerCase()),r=!a||t.tags&&t.tags.includes(a);return s&&r}))),[j,e,a]);return(0,l.jsx)("div",{className:"flex flex-col min-h-screen bg-gray-50 overflow-x-hidden max-w-full",children:(0,l.jsxs)("div",{className:"container mx-auto px-4 pb-20 pt-4 md:pt-6 md:pb-6 flex-grow overflow-x-hidden",children:[(0,l.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4",children:(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"Messages"})}),(0,l.jsxs)("div",{className:"relative mb-4 bg-white p-4 rounded-lg shadow-sm",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search messages...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",value:e,onChange:e=>t(e.target.value)}),(0,l.jsx)(r.KSO,{className:"absolute left-7 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),!A&&o&&(0,l.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4",children:(0,l.jsx)(x,{availableTags:I,selectedTag:a,onTagSelect:e=>{n(e)},onClearFilter:()=>{i()}})}),(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden p-2",children:A?(0,l.jsx)("div",{className:"p-4 space-y-4",children:[...Array(5)].map(((e,t)=>(0,l.jsx)("div",{className:"animate-pulse",children:(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("div",{className:"rounded-full bg-gray-200 h-12 w-12"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-2"}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded w-12"})]})},t)))}):C.length>0?(0,l.jsx)(m,{threads:C}):(0,l.jsx)(h,{searchTerm:e,selectedTags:!!a,showTablePrompt:!(!["Table","Circle","Hostings"].includes(a)||0!==C.length)&&a})})]})})}}}]);
//# sourceMappingURL=548.c96cb8e1.chunk.js.map