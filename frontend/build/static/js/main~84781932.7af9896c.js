"use strict";(self.webpackChunktymout_frontend=self.webpackChunktymout_frontend||[]).push([[282],{148:(e,t,n)=>{var s=n(9643),r=n(8367),a=n(5931),i=n(2768),o=(n(8818),n(6198)),l=n(1344),d=n(5432),c=n(6507);i.A.defaults.baseURL="http://localhost:3000",i.A.defaults.withCredentials=!0,(0,d.N)();r.createRoot(document.getElementById("root")).render((0,c.jsx)(s.StrictMode,{children:(0,c.jsx)(l.Ht,{client:l.qQ,children:(0,c.jsx)(a.Kd,{children:(0,c.jsx)(o.A,{})})})}))},2610:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(9643),r=n(7192),a=n(5931),i=n(8979),o=n(5432),l=n(8894),d=n(6507);const c=e=>{var t;let{members:n=[],event:c}=e;const u=(0,o.n)((e=>e.user)),m=(0,r.Zp)(),x=(0,l.jE)(),[g,h]=(0,s.useState)(null),[p,f]=(0,s.useState)(n),[v,y]=(0,s.useState)(!1),[b,j]=(0,s.useState)(null),w=(0,s.useRef)("");s.useEffect((()=>{f(n)}),[n]);const{mutate:N,isLoading:k}=(0,i.SZ)(),S=u&&(null===c||void 0===c||null===(t=c.host)||void 0===t?void 0:t.userId)===u._id,{data:C}=(0,i.nH)(null===c||void 0===c?void 0:c._id,{enabled:S&&!(null===c||void 0===c||!c._id)}),I=(null===C||void 0===C?void 0:C.length)||0,A=(null===c||void 0===c?void 0:c._id)||(null===c||void 0===c?void 0:c.id),T=e=>{if(!e)return"?";const t=e.split(" ");return t.length>=2?"".concat(t[0].charAt(0)).concat(t[t.length-1].charAt(0)).toUpperCase():e.charAt(0).toUpperCase()},_=e=>e?e.substring(0,2).toUpperCase():"?";return(0,d.jsxs)("div",{className:"p-4 relative",children:[S&&A&&(0,d.jsxs)(a.N_,{to:"/myevents/".concat(A,"/requests"),className:"flex items-center justify-between p-3 mb-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,d.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#4f46e5",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,d.jsx)("circle",{cx:"8.5",cy:"7",r:"4"}),(0,d.jsx)("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),(0,d.jsx)("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium",children:"Join Requests"}),(0,d.jsxs)("div",{className:"text-sm text-gray-500",children:[I," pending"]})]})]}),(0,d.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,d.jsx)("polyline",{points:"9 18 15 12 9 6"})})]}),0===p.length?(0,d.jsx)("div",{className:"text-center text-gray-400",children:"No attendees listed yet."}):(0,d.jsx)("ul",{className:"space-y-2",children:p.map(((e,t)=>{const n=e.userId||e.id,s=e.joinedAt?new Date(e.joinedAt).toLocaleDateString():"";return(0,d.jsxs)("li",{className:"flex items-center justify-between p-2 bg-gray-50 rounded component-card cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>(e=>{e&&m("/users/".concat(e))})(n),children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[e.avatar?(0,d.jsx)("img",{src:e.avatar,alt:e.name||"".concat(null===n||void 0===n?void 0:n.substring(0,8)),className:"w-8 h-8 rounded-full object-cover border border-gray-200 bg-white"}):(0,d.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-indigo-100 text-indigo-800 text-xs font-bold border border-gray-200",children:e.name?T(e.name):_(n)}),(0,d.jsxs)("div",{className:"flex flex-col",children:[(0,d.jsx)("span",{className:"font-medium text-gray-700 hover:text-indigo-600 transition-colors",children:e.name||"".concat(null===n||void 0===n?void 0:n.substring(0,8))}),s&&(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["Joined ",s]})]})]}),(0,d.jsx)("div",{className:"flex items-center gap-2",children:S&&n!==(null===u||void 0===u?void 0:u._id)&&(0,d.jsx)("button",{onClick:t=>((e,t,n)=>{e.stopPropagation(),t&&null!==c&&void 0!==c&&c._id&&(j(t),w.current=n||"this member",y(!0))})(t,n,e.name||e.fullName||null),disabled:g===n||k,className:"p-2 rounded-full text-gray-500 hover:bg-red-50 hover:text-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Remove member",children:g===n?(0,d.jsxs)("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,d.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,d.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,d.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),(0,d.jsx)("polyline",{points:"16 17 21 12 16 7"}),(0,d.jsx)("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})}),e.role&&(0,d.jsx)("span",{className:"ml-auto text-xs text-theme-accent",children:e.role})]},n||t)}))}),v&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg p-5 max-w-md w-full",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Remove Member"}),(0,d.jsxs)("p",{className:"text-gray-500 mb-4",children:["Are you sure you want to remove ",w.current," from this event? They will no longer have access to event details and chat."]}),(0,d.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,d.jsx)("button",{onClick:()=>{j(null),y(!1)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:k,children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{b&&null!==c&&void 0!==c&&c._id&&(h(b),N({eventId:c._id,userId:b},{onSuccess:()=>{f((e=>e.filter((e=>(e.userId||e.id)!==b)))),x.invalidateQueries({queryKey:["eventMembers",c._id]}),x.invalidateQueries({queryKey:["eventDetails",c._id]}),h(null),j(null),y(!1)},onError:e=>{h(null),j(null),y(!1)}}))},className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",disabled:k,children:k?"Removing...":"Remove"})]})]})})]})}},2775:(e,t,n)=>{n.d(t,{B:()=>a});var s=n(7109),r=n(2768);function a(e){return(0,s.I)({queryKey:["eventMembers",e],queryFn:()=>async function(e){try{return e&&(await r.A.get("/api/events/".concat(e,"/attendees"))).data.data||[]}catch(t){return[]}}(e),enabled:!!e})}},3075:(e,t,n)=>{n.d(t,{W:()=>l,f:()=>o});var s=n(7109),r=n(2768),a=n(5432);const i="".concat("http://localhost:3020","/api/messages");function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=(0,a.n)((e=>e.user)),n=null===t||void 0===t?void 0:t._id,{data:o={},isLoading:l}=(0,s.I)({queryKey:["chatPreviews",e.sort().join(","),n],queryFn:async()=>{if(!e.length||!n)return{};try{const s={timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}},a=e.map((e=>{const t="".concat(i,"/chat-preview/").concat(e,"?userId=").concat(n);return r.A.get(t,s)})),o=(await Promise.all(a)).reduce(((t,n,s)=>{const r=e[s],a=n.data||{lastMessage:null,unreadCount:0,lastMessageTime:null,lastSenderName:null};return t[r]=a,t}),{});try{localStorage.setItem("chat-previews",JSON.stringify({timestamp:(new Date).toISOString(),data:o}))}catch(t){}return o}catch(s){try{const e=localStorage.getItem("chat-previews");if(e){return JSON.parse(e).data}}catch(t){}return{}}},enabled:Boolean(e.length&&n),staleTime:0,refetchInterval:6e4,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4),onError:e=>{}});return{chatPreviews:o,isLoading:l}}function l(e){const{chatPreviews:t,isLoading:n}=o(e?[e]:[]);return{preview:t[e]||{},isLoading:n}}},4325:(e,t,n)=>{n.d(t,{A:()=>u});var s=n(9643),r=n(7109),a=n(8894),i=n(7027);const o=n(2768).A.create({baseURL:"http://localhost:3002",timeout:3e4});function l(e){return(0,r.I)({queryKey:["eventMoments",e],queryFn:()=>async function(e){try{return e&&(await o.get("/events/".concat(e,"/photos"))).data.data||[]}catch(t){return[]}}(e),enabled:!!e,staleTime:3e5})}function d(){const e=(0,a.jE)();return(0,i.n)({mutationFn:e=>{let{eventId:t,imageFile:n}=e;return async function(e,t){try{if(!e||!t)throw new Error("Event ID and image file are required");const n=new FormData;n.append("momentImage",t,t.name);const s={headers:{"Content-Type":void 0}};return(await o.post("/events/images/".concat(e,"/moments"),n,s)).data}catch(n){throw n}}(t,n)},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["eventMoments",n.eventId]})}})}o.interceptors.request.use((e=>{const t=localStorage.getItem("auth-storage");let n=null;if(t)try{var s;n=null===(s=JSON.parse(t).state)||void 0===s?void 0:s.token}catch(r){}return n&&(e.headers.Authorization="Bearer ".concat(n)),e}),(e=>Promise.reject(e)));var c=n(6507);const u=e=>{let{eventId:t}=e;const{data:n=[],isLoading:r,isError:a,refetch:i}=l(t),[o,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)(""),[g,h]=(0,s.useState)(!1),[p,f]=(0,s.useState)(n),v=(0,s.useRef)(null);s.useEffect((()=>{f(n)}),[n]);const y=d();return r?(0,c.jsx)("div",{className:"p-4 text-gray-500",children:"Loading photos..."}):a?(0,c.jsx)("div",{className:"p-4 text-red-500",children:"Failed to load photos."}):(0,c.jsxs)("div",{className:"relative min-h-[300px]",children:[(0,c.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 px-4 py-3",children:0===p.length?(0,c.jsx)("div",{className:"col-span-full text-gray-400 text-center py-4",children:"No photos yet."}):p.map(((e,t)=>(0,c.jsx)("div",{className:"relative aspect-square overflow-hidden rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer",children:(0,c.jsx)("img",{src:e,alt:"Event photo ".concat(t+1),className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})},t)))}),(0,c.jsx)("div",{className:"fixed bottom-24 right-6 z-50",children:(0,c.jsx)("button",{onClick:()=>{var e;null===(e=v.current)||void 0===e||e.click()},disabled:o,className:"p-4 rounded-full bg-indigo-600 text-white shadow-lg hover:bg-indigo-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all hover:scale-105","aria-label":"Upload photos",children:o?(0,c.jsxs)("svg",{className:"animate-spin h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,c.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,c.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,c.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,c.jsx)("path",{d:"M12 5v14M5 12h14"})})})}),(0,c.jsx)("input",{type:"file",ref:v,onChange:e=>{const n=Array.from(e.target.files);if(0===n.length)return;u(!0),x(""),h(!1);const s=n.map((e=>new Promise(((n,s)=>{e.type.startsWith("image/")?e.size>5242880?s(new Error("".concat(e.name," exceeds the 5MB size limit"))):y.mutate({eventId:t,imageFile:e},{onSuccess:e=>{f((t=>[...t,e.data.imageUrl])),n(e)},onError:e=>{s(e)}}):s(new Error("".concat(e.name," is not an image file")))}))));Promise.allSettled(s).then((e=>{const t=e.filter((e=>"fulfilled"===e.status)).length,n=e.filter((e=>"rejected"===e.status)).length;if(t>0&&(h(!0),setTimeout((()=>h(!1)),3e3),i()),n>0){const t=e.filter((e=>"rejected"===e.status)).map((e=>e.reason.message));x("Failed to upload ".concat(n," image(s): ").concat(t.join(", ")))}u(!1),v.current&&(v.current.value="")}))},accept:"image/*",multiple:!0,className:"hidden"}),m&&(0,c.jsx)("div",{className:"fixed bottom-36 right-6 left-6 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded z-50",children:m}),g&&(0,c.jsx)("div",{className:"fixed bottom-36 right-6 left-6 bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded z-50",children:"Images uploaded successfully!"})]})}},4356:(e,t,n)=>{n.d(t,{A:()=>l});var s=n(9643),r=n(2768),a=n(5432),i=n(6507);const o="http://localhost:3020",l=e=>{let{event:t,onClick:n,isAdmin:l,onTagFilter:d,selectedTag:c,onTagClick:u,showTags:m=!0,toggleShowTags:x}=e;const[g,h]=(0,s.useState)([]),[p,f]=(0,s.useState)(""),[v,y]=(0,s.useState)(null),[b,j]=(0,s.useState)(""),[w,N]=(0,s.useState)(""),[k,S]=(0,s.useState)(!1),[C,I]=(0,s.useState)(!1),[A,T]=(0,s.useState)(!1),_=(0,a.n)((e=>e.user));(0,s.useEffect)((()=>{_&&t&&t.host&&("object"===typeof t.host?t.host.userId?T(t.host.userId.toString()===_._id.toString()):t.host._id?T(t.host._id.toString()===_._id.toString()):t.host.id&&T(t.host.id.toString()===_._id.toString()):T(t.host.toString()===_._id.toString()))}),[_,t]),(0,s.useEffect)((()=>{null!==t&&void 0!==t&&t._id&&L()}),[null===t||void 0===t?void 0:t._id]),(0,s.useEffect)((()=>{const e=e=>{k&&!e.target.closest(".tag-dropdown-container")&&S(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[k]);const L=async()=>{I(!0);try{const e=await r.A.get("".concat(o,"/api/tags?eventId=").concat(t._id));h(e.data)}catch(e){N("Failed to fetch tags")}finally{I(!1)}};if(!t)return null;t._id||t.id;const E=t.title||t.eventName||"Event",q=t.event_image||t.thumbnail||t.imageUrl||"/default-group.png",D=E.length>25?"".concat(E.substring(0,25),"..."):E;return(0,i.jsxs)("div",{className:"flex flex-col w-full",children:[(0,i.jsxs)("div",{className:"flex items-center w-full",children:[(0,i.jsxs)("button",{className:"flex items-center gap-3 group focus:outline-none w-full transition-all duration-300 justify-start flex-grow",onClick:n,"aria-label":"View details for ".concat(E),type:"button",children:[(0,i.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,i.jsx)("img",{src:q,alt:E,className:"w-10 h-10 rounded-lg object-cover border border-gray-200 bg-gray-50 group-hover:brightness-95 group-focus:brightness-95 transition-all duration-300 shadow-sm"}),(0,i.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,i.jsx)("div",{className:"flex flex-col items-start flex-grow min-w-0 text-left",children:(0,i.jsx)("span",{className:"font-semibold text-base text-gray-800 group-hover:text-indigo-600 group-focus:text-indigo-600 transition-colors duration-300 overflow-hidden text-ellipsis whitespace-nowrap w-full text-left",title:E,children:D})})]}),A&&(0,i.jsxs)("div",{className:"relative tag-dropdown-container ml-2",children:[(0,i.jsx)("button",{type:"button",className:"w-8 h-8 flex items-center justify-center rounded-full bg-indigo-50 text-indigo-700 hover:bg-indigo-100",onClick:()=>S((e=>!e)),"aria-label":"Manage tags",children:(0,i.jsx)("span",{className:"text-base font-bold",children:"+"})}),k&&(0,i.jsxs)("div",{className:"absolute right-0 top-9 z-50 bg-white border border-gray-200 rounded shadow-lg min-w-[180px] max-w-[220px] max-h-64 overflow-y-auto p-2",children:[(0,i.jsx)("div",{className:"text-xs text-gray-600 mb-2 italic",children:"Only host can add or remove up to 3 tags"}),(0,i.jsxs)("div",{className:"flex gap-1 mb-2 items-center",children:[(0,i.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),maxLength:20,placeholder:"Add new tag...",className:"border px-2 py-1 rounded text-xs flex-1 w-[100px] min-w-0",style:{maxWidth:"120px"},disabled:g.length>=3}),(0,i.jsx)("button",{onClick:async()=>{if(p.trim())if(g.length>=3)N("Maximum of 3 tags allowed");else{N("");try{const e=p.trim().toLowerCase();await r.A.post("".concat(o,"/api/tags"),{name:e,eventId:t._id}),f(""),L()}catch(s){var e,n;N((null===(e=s.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.error)||"Failed to add tag")}}},className:"bg-indigo-600 text-white px-2 py-1 rounded text-xs hover:bg-indigo-700 whitespace-nowrap flex-shrink-0",disabled:g.length>=3||!p.trim(),style:{opacity:g.length>=3||!p.trim()?.6:1},children:"Add"})]}),C?(0,i.jsx)("div",{className:"p-2 text-xs text-gray-500",children:"Loading..."}):w?(0,i.jsx)("div",{className:"p-2 text-xs text-red-500",children:w}):0===g.length?(0,i.jsx)("div",{className:"p-2 text-xs text-gray-400",children:"No tags"}):g.map((e=>(0,i.jsx)("div",{className:"flex items-center w-full mb-2",children:v===e._id?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"text",value:b,onChange:e=>j(e.target.value),maxLength:20,className:"border px-1 py-0.5 rounded text-xs",style:{width:70}}),(0,i.jsx)("button",{onClick:()=>(async e=>{if(b.trim()){N("");try{const t=b.trim().toLowerCase();await r.A.put("".concat(o,"/api/tags/").concat(e),{name:t}),y(null),j(""),L()}catch(s){var t,n;N((null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||"Failed to edit tag")}}})(e._id),className:"text-green-600 text-xs font-bold",children:"\u2714"}),(0,i.jsx)("button",{onClick:()=>{y(null),j("")},className:"text-gray-400 text-xs font-bold",children:"\u2716"})]}):(0,i.jsxs)("div",{className:"flex items-center w-full",children:[(0,i.jsxs)("span",{className:"inline-block bg-indigo-100 text-indigo-700 px-3 py-0.5 rounded-full text-sm font-medium hover:bg-indigo-200 flex-shrink-0",children:["#",e.name]}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)("button",{onClick:()=>(async e=>{N("");try{await r.A.delete("".concat(o,"/api/tags/").concat(e)),L()}catch(t){N("Failed to delete tag")}})(e._id),className:"text-red-600 text-lg font-bold ml-2 p-1 hover:bg-red-50 rounded-full",title:"Delete tag",children:"\ud83d\uddd1"})]})},e._id)))]})]}),(0,i.jsx)("button",{type:"button",className:"flex items-center justify-center w-7 h-7 ml-2 rounded-full border border-indigo-200 bg-white text-indigo-700 hover:bg-indigo-50 transition focus:outline-none",onClick:x,"aria-label":m?"Hide tags":"Show tags",style:{minWidth:28},children:m?(0,i.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("polyline",{points:"6 12 10 8 14 12"})}):(0,i.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("polyline",{points:"6 8 10 12 14 8"})})})]}),(0,i.jsx)("div",{className:"flex items-center gap-2 mt-1 relative",children:(0,i.jsx)("div",{className:"overflow-hidden transition-all duration-300 ".concat(m?"max-h-32 opacity-100":"max-h-0 opacity-0 pointer-events-none"),style:{display:"flex",alignItems:"center",gap:"8px",WebkitOverflowScrolling:"touch"},children:g.map((e=>{const t=c&&c._id===e._id;return(0,i.jsxs)("span",{className:"inline-flex items-center px-3 py-1 mr-2 rounded-full text-sm font-medium cursor-pointer transition-colors\n                  ".concat(t?"bg-indigo-600 text-white":"bg-indigo-100 text-indigo-700 hover:bg-indigo-200"),onClick:n=>{u&&u(e),d&&d(t?null:e)},style:{display:"inline-block"},title:"Click to add tag to message and filter by tag",children:["#",e.name]},e._id)}))})}),w&&(0,i.jsx)("div",{className:"text-red-500 text-xs mt-1",children:w})]})}},5224:(e,t,n)=>{n.d(t,{A:()=>u});var s=n(5038),r=n(9643),a=n(2218),i=n(7192),o=n(2768),l=n(5432),d=n(6507);const c=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-purple-100 text-purple-800","bg-pink-100 text-pink-800","bg-yellow-100 text-yellow-800","bg-indigo-100 text-indigo-800"],u=e=>{var t,n,u,m,x,g;let{event:h}=e;const[p,f]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!1),[b,j]=(0,r.useState)(null),[w,N]=(0,r.useState)(!1),[k,S]=(0,r.useState)(!1),C=(0,i.Zp)(),I=(0,l.n)((e=>e.user));(0,r.useEffect)((()=>{I&&h&&h.host&&("object"===typeof h.host?h.host.userId?N(h.host.userId.toString()===I._id.toString()):h.host._id?N(h.host._id.toString()===I._id.toString()):h.host.id&&N(h.host.id.toString()===I._id.toString()):N(h.host.toString()===I._id.toString()))}),[I,h]);const A=Array.isArray(h.attendees)?h.attendees.length:"number"===typeof h.attendees?h.attendees:0,T=(()=>{var e,t,n,s,r,a,i;if(null!==h&&void 0!==h&&null!==(e=h.place)&&void 0!==e&&null!==(t=e.coordinates)&&void 0!==t&&t.latitude&&null!==h&&void 0!==h&&null!==(n=h.place)&&void 0!==n&&null!==(s=n.coordinates)&&void 0!==s&&s.longitude){const{latitude:e,longitude:t}=h.place.coordinates;return"https://www.google.com/maps/search/?api=1&query=".concat(e,",").concat(t)}return null!==h&&void 0!==h&&null!==(r=h.place)&&void 0!==r&&r.name&&null!==h&&void 0!==h&&null!==(a=h.location)&&void 0!==a&&a.city?"https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent("".concat(h.place.name,", ").concat(h.location.city,", India"))):null!==h&&void 0!==h&&null!==(i=h.location)&&void 0!==i&&i.city?"https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent("".concat(h.location.city,", India"))):null})(),_=e=>{if(!e)return"Not specified";try{return new Date(e).toLocaleDateString("en-US",{day:"2-digit",month:"long",year:"numeric"})}catch(t){return e}},L=h.host||h.organizer,E=(null===L||void 0===L?void 0:L.name)||(null===L||void 0===L?void 0:L.username)||(null===L||void 0===L?void 0:L.email)||"Unknown",q=(null===L||void 0===L?void 0:L.image)||(null===L||void 0===L?void 0:L.avatar)||null,D=h.organizer?"Organizer":"Host",M=h.tags||h.tagList||[],R="closed"===h.status||h.isClosed,F=h.price||h.fee||0,z=h.rsvpDeadline||h.rsvp||null,B=h.type||h.eventType||"Event",P=(null===(t=h.date)||void 0===t?void 0:t.end)||h.endDate||null,[U,W]=(0,r.useState)(!1),[K,H]=(0,r.useState)({}),[Q,J]=(0,r.useState)(!1),[O,Z]=(0,r.useState)(""),V=e=>{const{name:t,value:n}=e.target;H((e=>(0,s.A)((0,s.A)({},e),{},{[t]:n})))},[Y,$]=(0,r.useState)(!1),[G,X]=(0,r.useState)(h.announcement||""),[ee,te]=(0,r.useState)(!1),[ne,se]=(0,r.useState)("");return(0,d.jsxs)("div",{className:"p-2 sm:p-4 text-gray-700 space-y-4 overflow-x-hidden",children:[(0,d.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-2 flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\udccc"}),(0,d.jsx)("span",{className:"font-semibold text-base",children:"Announcement"}),w&&(0,d.jsx)("button",{onClick:()=>$(!0),className:"ml-2 text-xs text-indigo-600 hover:underline focus:outline-none",children:"Edit"})]}),h.announcement&&!Y&&(0,d.jsx)("div",{className:"text-gray-800 whitespace-pre-line break-words",children:h.announcement}),!h.announcement&&!Y&&(0,d.jsx)("div",{className:"italic text-gray-400",children:"No announcement yet."}),Y&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fadein",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg p-5 max-w-md w-full",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Edit Announcement"}),(0,d.jsx)("textarea",{value:G,onChange:e=>X(e.target.value),className:"w-full border rounded px-2 py-1",rows:4,placeholder:"Enter announcement...",disabled:ee}),ne&&(0,d.jsx)("p",{className:"text-red-500 text-xs mt-2",children:ne}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,d.jsx)("button",{onClick:()=>$(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:ee,children:"Cancel"}),(0,d.jsx)("button",{onClick:async()=>{te(!0),se("");try{const e=h._id||h.id;await o.A.put("".concat("http://localhost:3000","/api/events/").concat(e),{announcement:G},{headers:{"x-auth-token":localStorage.getItem("token")}}),$(!1)}catch(n){var e,t;se((null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to update announcement.")}finally{te(!1)}},className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:ee,children:ee?"Saving...":"Save"})]})]})})]}),(0,d.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-2",children:[(0,d.jsxs)("h2",{className:"text-lg font-bold flex items-center gap-2 mb-2",children:[(0,d.jsx)(a.__w,{className:"text-indigo-500"})," About this ",B]}),(0,d.jsx)("p",{className:"whitespace-pre-line break-words break-all text-gray-800 text-base animate-fadein",children:h.description||"No description available."})]}),(0,d.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-2",children:[(0,d.jsxs)("h3",{className:"text-base font-semibold flex items-center gap-2 mb-3",children:[(0,d.jsx)(a.bfZ,{className:"text-indigo-500"})," Details"]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[" ",(0,d.jsx)(a.bfZ,{className:"text-indigo-400"})," Date:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:_((null===(n=h.date)||void 0===n?void 0:n.start)||h.date)}),P&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.bfZ,{className:"text-indigo-400"})," End Date:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:_(P)})]}),h.time&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.w_X,{className:"text-indigo-400"})," Time:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:(e=>{if(!e)return null;if(e.length<=5&&e.includes(":"))return e;try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(t){return e}})(h.time)})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.YXz,{className:"text-indigo-400"})," Attendees:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:(0,d.jsxs)("span",{className:"inline-block px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-700 text-xs font-semibold",children:[A," ",1===A?"person":"people"]})}),h.capacity&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.YXz,{className:"text-indigo-400"})," Capacity:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:(0,d.jsx)("span",{className:"inline-block px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 text-xs font-semibold",children:h.capacity})})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.wJQ,{className:"text-indigo-400"})," Type:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:B}),void 0!==F&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.gPb,{className:"text-indigo-400"})," Price:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:(0,d.jsx)("span",{className:"inline-block px-2 py-0.5 rounded-full ".concat(0===F?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"," text-xs font-semibold"),children:0===F?"Free":"\u20b9".concat(F)})})]}),z&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.w_X,{className:"text-indigo-400"})," RSVP by:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:_(z)})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 justify-start text-gray-600 font-medium",children:[(0,d.jsx)(a.A7C,{className:"text-green-500 animate-pulse"})," Status:"]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:R?(0,d.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-100 text-red-700 text-xs font-semibold",children:[(0,d.jsx)(a._Hm,{className:"text-red-500"})," Closed"]}):(0,d.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-100 text-green-700 text-xs font-semibold",children:"Open"})})]})]}),M.length>0&&(0,d.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-2",children:[(0,d.jsxs)("h3",{className:"text-base font-semibold flex items-center gap-2 mb-3",children:[(0,d.jsx)(a.wJQ,{className:"text-indigo-500"})," Tags"]}),(0,d.jsx)("div",{className:"flex flex-wrap gap-2",children:M.map(((e,t)=>(0,d.jsxs)("span",{className:"flex items-center px-3 py-1 rounded-full text-sm font-semibold ".concat(c[t%c.length]," transition-colors duration-200"),children:[0===t&&(0,d.jsx)(a.wJQ,{className:"mr-1 text-indigo-400 text-xs"})," ",e]},t)))})]}),(0,d.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-2",children:[(0,d.jsxs)("h3",{className:"text-base font-semibold flex items-center gap-2 mb-3",children:[(0,d.jsx)(a.vq8,{className:"text-indigo-500"})," Location"]}),(0,d.jsxs)("div",{className:"flex items-start gap-2 mb-1",children:[(0,d.jsx)(a.vq8,{className:"text-indigo-400 mt-0.5"}),(0,d.jsxs)("div",{className:"min-w-0 break-words",children:[(null===h||void 0===h||null===(u=h.place)||void 0===u?void 0:u.name)&&(0,d.jsx)("div",{className:"font-medium",children:h.place.name}),(0,d.jsx)("div",{children:(null===h||void 0===h||null===(m=h.place)||void 0===m?void 0:m.address)||(null===(x=h.location)||void 0===x?void 0:x.city)||"Location not specified"})]})]}),(0,d.jsxs)("div",{className:"flex gap-2 mt-2",children:[T&&(0,d.jsxs)("a",{href:T,target:"_blank",rel:"noopener noreferrer",className:"inline-flex flex-wrap items-center px-3 py-1.5 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 max-w-full break-words",children:[(0,d.jsx)(a.vq8,{className:"mr-1.5"}),"Open in Google Maps",(0,d.jsx)(a.EQc,{className:"ml-1.5 h-3 w-3"})]}),(0,d.jsxs)("button",{onClick:()=>{var e,t;const n=(null===h||void 0===h||null===(e=h.place)||void 0===e?void 0:e.address)||(null===(t=h.location)||void 0===t?void 0:t.city)||"";n&&(navigator.clipboard.writeText(n),S(!0),setTimeout((()=>S(!1)),1200))},className:"inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md bg-gray-100 hover:bg-gray-100 text-gray-700 border border-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-400 transition-colors",children:[(0,d.jsx)(a.vq8,{className:"mr-1.5 text-indigo-400"}),"Copy address"]}),k&&(0,d.jsx)("span",{className:"text-green-600 text-xs ml-2 animate-fadein",children:"Copied!"})]})]}),L&&(0,d.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-2 flex items-center gap-4 cursor-pointer group",title:"View profile",tabIndex:0,onClick:()=>(null===L||void 0===L?void 0:L.id)&&C("/profile/".concat(L.id)),onKeyDown:e=>{"Enter"===e.key&&null!==L&&void 0!==L&&L.id&&C("/profile/".concat(L.id))},children:[q?(0,d.jsx)("img",{src:q,alt:E,className:"w-12 h-12 rounded-full object-cover border border-gray-200 bg-gray-50 group-hover:brightness-95 transition-all duration-200"}):(0,d.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-indigo-100 text-indigo-700 text-xl font-bold border border-gray-200 group-hover:brightness-95 transition-all duration-200",children:(null===(g=E[0])||void 0===g?void 0:g.toUpperCase())||"?"}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"font-semibold text-gray-800 text-base flex items-center gap-1",children:[E,(null===L||void 0===L?void 0:L.verified)&&(0,d.jsx)(a.A7C,{className:"text-indigo-500 ml-1",title:"Verified"})]}),(0,d.jsxs)("div",{className:"text-xs text-gray-500",children:[D,(null===L||void 0===L?void 0:L.bio)&&(0,d.jsx)("span",{className:"ml-2 text-gray-400",children:L.bio})]})]})]}),w&&(0,d.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-2 flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:()=>{var e,t,n,s;H({title:h.title||h.eventName||"",description:h.description||"",date:(null===(e=h.date)||void 0===e?void 0:e.start)||h.date||"",endDate:(null===(t=h.date)||void 0===t?void 0:t.end)||h.endDate||"",time:h.time||"",capacity:h.capacity||"",type:h.type||h.eventType||"",price:h.price||h.fee||0,rsvp:h.rsvpDeadline||h.rsvp||"",location:(null===(n=h.place)||void 0===n?void 0:n.address)||(null===(s=h.location)||void 0===s?void 0:s.city)||"",tags:(h.tags||h.tagList||[]).join(", ")}),W(!0),Z("")},className:"flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors",disabled:Q,children:"Edit"}),(0,d.jsxs)("button",{onClick:()=>f(!0),className:"flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors",disabled:v,children:[(0,d.jsx)(a.qbC,{className:"mr-1.5"}),v?"Deleting...":"Delete Event"]})]}),b&&(0,d.jsx)("p",{className:"text-red-500 text-xs mt-1",children:b})]}),U&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fadein",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg p-5 max-w-md w-full",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Edit Group Info"}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("input",{name:"title",value:K.title,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Title"}),(0,d.jsx)("textarea",{name:"description",value:K.description,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Description",rows:3}),(0,d.jsx)("input",{name:"date",value:K.date,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Start Date",type:"date"}),(0,d.jsx)("input",{name:"endDate",value:K.endDate,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"End Date",type:"date"}),(0,d.jsx)("input",{name:"time",value:K.time,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Time",type:"time"}),(0,d.jsx)("input",{name:"capacity",value:K.capacity,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Capacity",type:"number"}),(0,d.jsx)("input",{name:"type",value:K.type,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Type"}),(0,d.jsx)("input",{name:"price",value:K.price,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Price",type:"number"}),(0,d.jsx)("input",{name:"rsvp",value:K.rsvp,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"RSVP Deadline",type:"date"}),(0,d.jsx)("input",{name:"location",value:K.location,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Location"}),(0,d.jsx)("input",{name:"tags",value:K.tags,onChange:V,className:"w-full border rounded px-2 py-1",placeholder:"Tags (comma separated)"})]}),O&&(0,d.jsx)("p",{className:"text-red-500 text-xs mt-2",children:O}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,d.jsx)("button",{onClick:()=>W(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:Q,children:"Cancel"}),(0,d.jsx)("button",{onClick:async()=>{J(!0),Z("");try{const e=h._id||h.id,t={title:K.title,description:K.description,date:{start:K.date,end:K.endDate},time:K.time,capacity:K.capacity,type:K.type,price:K.price,rsvpDeadline:K.rsvp,location:{city:K.location},tags:K.tags.split(",").map((e=>e.trim())).filter(Boolean)};await o.A.put("".concat("http://localhost:3000","/api/events/").concat(e),t,{headers:{"x-auth-token":localStorage.getItem("token")}}),W(!1),window.location.reload()}catch(n){var e,t;Z((null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to update event.")}finally{J(!1)}},className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:Q,children:Q?"Saving...":"Save"})]})]})}),p&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fadein",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg p-5 max-w-md w-full",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Delete Event"}),(0,d.jsx)("p",{className:"text-gray-500 mb-4",children:"Are you sure you want to delete this event? This action is irreversible and all event data will be permanently removed."}),(0,d.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,d.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:v,children:"Cancel"}),(0,d.jsx)("button",{onClick:async()=>{try{y(!0),j(null);const e=h._id||h.id;await o.A.delete("".concat("http://localhost:3000","/api/events/").concat(e)),C("/explore"),window.location.reload()}catch(e){j("Failed to delete event. Please try again."),y(!1),f(!1)}},className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",disabled:v,children:v?"Deleting...":"Delete"})]})]})})]})}},5790:(e,t,n)=>{n.d(t,{A:()=>g});var s=n(9643),r=n(7192),a=n(8979),i=n(2218),o=n(3169),l=n(4702),d=n(6507);const c=e=>{let{event:t,isPending:n=!1,unreadCount:a=0,showUnreadBadge:c=!1,lastMessage:u="",lastMessageTime:m}=e;const x=(0,r.Zp)(),g=t.date&&t.date.start?(()=>{const e=new Date(t.date.start),n=e.getDate().toString().padStart(2,"0"),s=e.toLocaleString("en-US",{month:"short"}),r=e.getFullYear();return"".concat(n,"/").concat(s,"/").concat(r)})():"Date not available",h=(0,s.useMemo)((()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(!e)return"No messages yet";const n="string"===typeof e?e:(null===e||void 0===e?void 0:e.text)||"No messages yet";return n.length>t?"".concat(n.substring(0,t),"..."):n}(u)),[u]),p=!(!t.date||!t.date.start)&&(0,o.A)(new Date(t.date.start)),f=()=>{x("/myevents/".concat(t._id,"/chat"))},[v,y]=(0,s.useState)(!1),[b,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)(0),[k,S]=(0,s.useState)(0),[C,I]=(0,s.useState)(""),[A,T]=(0,s.useState)(!1),_="".concat(window.location.origin,"/events/").concat(t._id),L=e=>{let{rating:t,setRating:n,disabled:s}=e;return(0,d.jsx)("div",{className:"flex",children:[1,2,3,4,5].map((e=>(0,d.jsx)("button",{type:"button",disabled:s,onClick:()=>n(e),className:"text-xl focus:outline-none",children:e<=t?(0,d.jsx)(i.gt3,{className:"text-yellow-400"}):(0,d.jsx)(i.wei,{className:"text-gray-300 hover:text-yellow-200"})},e)))})};return(0,d.jsxs)("div",{className:"w-full flex flex-col px-0 py-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 ".concat(n?"":"cursor-pointer"),onClick:f,role:n?void 0:"button",tabIndex:n?void 0:0,onKeyPress:n?void 0:e=>{"Enter"===e.key&&f()},children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("img",{src:t.event_image,alt:t.title,className:"w-14 h-14 rounded object-cover border border-gray-200 bg-gray-50",loading:"lazy"}),c&&(0,d.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full px-2 py-0.5 shadow-lg z-10",children:a})]}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("div",{className:"font-semibold text-base text-primary mb-0.5",children:t.title}),(()=>{const e="private"===t.access?(0,d.jsx)("span",{className:"inline-block bg-rose-100 text-rose-700 text-xs font-semibold px-2 py-0.5 rounded-full mr-1",children:"Private"}):"public"===t.access?(0,d.jsx)("span",{className:"inline-block bg-emerald-100 text-emerald-700 text-xs font-semibold px-2 py-0.5 rounded-full mr-1",children:"Public"}):null;return(0,d.jsx)(d.Fragment,{children:e})})()]}),m&&(0,d.jsx)("span",{className:"text-xs text-gray-400",children:(e=>{if(!e)return"";return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})(m)})]}),(0,d.jsx)("div",{className:"text-xs text-gray-600 truncate pr-2 max-w-[240px]",children:h}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,d.jsx)("div",{className:"text-xs text-theme-accent",children:(0,d.jsx)("span",{className:"font-mono",children:t.ticketCode})}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"inline-block bg-white text-indigo-600 text-xs font-semibold px-0 py-0.5",children:g}),!n&&!p&&(0,d.jsx)("button",{onClick:e=>{e.stopPropagation(),(e=>{e.stopPropagation(),navigator.clipboard.writeText(_).then((()=>{y(!0),setTimeout((()=>y(!1)),2e3)})).catch((e=>{}))})(e)},className:"flex items-center justify-center p-1.5 rounded text-sm font-medium transition ".concat(v?"bg-green-100 text-green-700":"bg-white hover:bg-gray-50 text-indigo-600"),children:v?(0,d.jsx)(i.CMH,{className:"text-green-700",size:14}):(0,d.jsx)(i.Zzu,{className:"text-indigo-600",size:14})})]})]})]})]}),n?(0,d.jsx)("div",{className:"mt-2 self-end flex items-center justify-center py-1 px-3 rounded text-sm font-medium bg-yellow-100 text-yellow-700",children:"rejected"===t.status?"Rejected":"Pending Approval"}):p?(0,d.jsxs)("button",{onClick:e=>{e.stopPropagation(),j(!0)},className:"mt-2 self-end flex items-center justify-center py-1 px-3 rounded text-sm font-medium transition bg-indigo-100 hover:bg-indigo-200 text-indigo-700",children:[(0,d.jsx)(i.j1Q,{className:"mr-1",size:12}),"Give Feedback"]}):null,b&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md w-full",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Event Feedback"}),(0,d.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),T(!0);try{const e={hostRating:w,eventRating:k,comment:C};await l.default.submitFeedback(t._id,e),j(!1),N(0),S(0),I(""),alert("Thank you for your feedback!")}catch(n){alert("Failed to submit feedback. Please try again.")}finally{T(!1)}},children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"How would you rate the host?"}),(0,d.jsx)(L,{rating:w,setRating:N,disabled:A})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"How would you rate the event overall?"}),(0,d.jsx)(L,{rating:k,setRating:S,disabled:A})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comments (optional)"}),(0,d.jsx)("textarea",{value:C,onChange:e=>I(e.target.value),disabled:A,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:"3",placeholder:"Share your thoughts about the event..."})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,d.jsx)("button",{type:"button",onClick:()=>{j(!1)},disabled:A,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",disabled:A||0===w||0===k,className:"px-4 py-2 rounded-md shadow-sm text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ".concat(0===w||0===k?"bg-indigo-300 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"),children:A?"Submitting...":"Submit Feedback"})]})]})]})})]})};var u=n(3075),m=n(1344),x=n(5936);const g=()=>{var e;const{data:t=[],isLoading:n,isError:l}=(0,a.nI)(),g=(0,r.zy)(),[h,p]=(0,s.useState)((null===(e=g.state)||void 0===e?void 0:e.activeTab)||"upcoming");(0,s.useEffect)((()=>{var e;null!==(e=g.state)&&void 0!==e&&e.activeTab&&window.history.replaceState({},document.title)}),[g.state]);const[f,v]=(0,s.useState)(""),y=e=>!(!e.date||!e.date.start)&&(0,o.A)(new Date(e.date.start)),b=t.filter((e=>{const t="archieve"===h?y(e):"pending"===h?"pending"===e.status||"rejected"===e.status:!y(e)&&("accepted"===e.status||!e.status),n=""===f.trim()||e.title&&e.title.toLowerCase().includes(f.toLowerCase());return t&&n})),j=b.map((e=>e._id)),{chatPreviews:w}=(0,u.f)(j);return(0,s.useEffect)((()=>{const e=(0,x.io)("http://localhost:3020",{reconnectionAttempts:10,reconnectionDelay:1e3,timeout:3e4,transports:["websocket","polling"],withCredentials:!0,forceNew:!0});e.on("connect",(()=>{m.qQ.refetchQueries({queryKey:["chatPreviews"],exact:!1})})),e.on("connect_error",(e=>{const t=setInterval((()=>{m.qQ.refetchQueries({queryKey:["chatPreviews"],exact:!1})}),3e4);return()=>clearInterval(t)})),e.on("disconnect",(e=>{})),e.on("unreadCountsChanged",(e=>{m.qQ.refetchQueries({queryKey:["chatPreviews"],exact:!1})})),e.on("attendeeStatusUpdated",(e=>{Promise.all([m.qQ.refetchQueries({queryKey:["myEvents"],force:!0}),m.qQ.refetchQueries({queryKey:["eventsAttending"],force:!0}),m.qQ.refetchQueries({queryKey:["hostedEvents"],force:!0})]).then((()=>{})).catch((e=>{}))}));const t=setTimeout((()=>{e.emit("testAttendeeUpdate",{test:!0,timestamp:(new Date).toISOString()})}),5e3);return()=>{clearTimeout(t),e.disconnect()}}),[]),(0,d.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-primary",children:"Chats"}),(0,d.jsxs)("div",{className:"relative w-full max-w-xs ml-3",children:[(0,d.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,d.jsx)(i.KSO,{className:"h-4 w-4 text-gray-400"})}),(0,d.jsx)("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-full text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Search chats...",value:f,onChange:e=>v(e.target.value)})]})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-2 mb-6",children:[(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:()=>p("upcoming"),className:"px-3 py-1.5 rounded-full font-medium text-sm transition \n              ".concat("upcoming"===h?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-indigo-50"),children:"My Tables"}),(0,d.jsx)("button",{onClick:()=>p("pending"),className:"px-3 py-1.5 rounded-full font-medium text-sm transition \n              ".concat("pending"===h?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-indigo-50"),children:"Pending"})]}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:(0,d.jsxs)("button",{onClick:()=>p("archieve"),className:"flex items-center gap-1 px-3 py-1 rounded-full font-medium text-sm transition \n              ".concat("archieve"===h?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-indigo-50"),children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7v10a2 2 0 01-2 2H6a2 2 0 01-2-2V7m16 0V5a2 2 0 00-2-2H6a2 2 0 00-2 2v2m16 0H4"})}),"Archieve"]})})]}),n?(0,d.jsx)("div",{className:"text-gray-500",children:"Loading events..."}):l?(0,d.jsx)("div",{className:"text-red-500",children:"Failed to load events."}):b.length?(0,d.jsx)("div",{className:"flex flex-col space-y-3",children:b.map((e=>{const t=(null===w||void 0===w?void 0:w[e._id])||{},n=t.unreadCount>0;return(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm",children:(0,d.jsx)(c,{event:e,isPending:"pending"===h,unreadCount:t.unreadCount||0,showUnreadBadge:n,lastMessage:t.lastMessage,lastMessageTime:t.lastMessageTime})},e._id)}))}):(0,d.jsx)("div",{className:"text-gray-500",children:""!==f.trim()?'No chats matching "'.concat(f,'".'):"No ".concat("archieve"===h?"archieve":h," events found.")})]})}},6391:(e,t,n)=>{n.d(t,{A:()=>w});var s=n(9643),r=n(7192),a=n(6507);const i=e=>{let{bio:t=""}=e;const[n,r]=(0,s.useState)(!1),i=t.trim().slice(0,100),o=i.length>45,l=n||!o?i:(d=45,i.slice(0,d));var d;return(0,a.jsx)("div",{className:"px-4 pb-2 text-sm text-gray-700 text-left",children:(0,a.jsxs)("span",{className:"font-medium text-theme-accent",children:[l,o&&!n&&(0,a.jsxs)(a.Fragment,{children:["..."," ",(0,a.jsx)("button",{className:"text-theme-accent underline focus:outline-none",onClick:()=>r(!0),type:"button",children:"more"})]})]})})},o=e=>{let{activeTab:t,setActiveTab:n,tabs:s=[]}=e;return(0,a.jsx)("div",{className:"flex border-b border-gray-200 bg-white sticky top-0 z-10",children:s.map((e=>(0,a.jsx)("button",{className:"flex-1 py-2 text-sm font-medium focus:outline-none transition-colors ".concat(t===e.key?"text-theme-accent border-b-2 border-theme-accent bg-gray-50":"text-gray-500"),onClick:()=>n(e.key),children:e.label},e.key)))})};var l=n(2610),d=n(5224);const c=e=>{let{announcements:t=[]}=e;return(0,a.jsx)("div",{className:"p-4",children:0===t.length?(0,a.jsx)("div",{className:"text-center text-gray-400",children:"No announcements yet."}):(0,a.jsx)("ul",{className:"space-y-2",children:t.map(((e,t)=>(0,a.jsxs)("li",{className:"p-3 bg-yellow-50 rounded component-card border-l-4 border-theme-accent",children:[(0,a.jsx)("div",{className:"font-semibold text-theme-accent mb-1",children:e.title||"Announcement"}),(0,a.jsx)("div",{className:"text-gray-700 text-sm",children:e.text||e.content}),e.date&&(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:e.date})]},e.id||t)))})})};var u=n(7109),m=n(2768),x=n(5432);async function g(){try{var e;const t=null===(e=x.n.getState().user)||void 0===e?void 0:e._id;if(!t)return[];return(await m.A.get("/api/events/myevents/".concat(t))).data.data||[]}catch(t){return[]}}function h(e){return(0,u.I)({queryKey:["eventBio",e],queryFn:()=>async function(e){try{if(!e)return"";const t=(await m.A.get("/api/events/".concat(e))).data.data;return t&&(t.bio||t.description)||""}catch(t){return""}}(e),enabled:!!e})}function p(){return Promise.resolve([{key:"moments",label:"Moments"},{key:"members",label:"Members"},{key:"about",label:"About"},{key:"chat",label:"Chat"}])}var f=n(2775);function v(e){return(0,u.I)({queryKey:["eventAnnouncements",e],queryFn:()=>async function(e){try{return e&&(await m.A.get("/api/events/".concat(e,"/announcements"))).data.data||[]}catch(t){return[]}}(e),enabled:!!e})}const y=(0,n(5469).v)((e=>({activeTab:"moments",setActiveTab:t=>e({activeTab:t})}))),b="http://localhost:3020",j=e=>{let{eventId:t,isAdmin:n}=e;const[r,i]=(0,s.useState)([]),[o,l]=(0,s.useState)(""),[d,c]=(0,s.useState)(null),[u,x]=(0,s.useState)(""),[g,h]=(0,s.useState)(""),[p,f]=(0,s.useState)(!1),v=async()=>{f(!0);try{const e=await m.A.get("".concat(b,"/api/tags?eventId=").concat(t));i(e.data)}catch(e){h("Failed to fetch tags")}finally{f(!1)}};(0,s.useEffect)((()=>{t&&v()}),[t]);return n?(0,a.jsxs)("div",{className:"p-4 border rounded bg-gray-50 mt-4",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Manage Tags"}),g&&(0,a.jsx)("div",{className:"text-red-500 text-sm mb-2",children:g}),(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),maxLength:20,placeholder:"Add new tag...",className:"border px-2 py-1 rounded text-sm"}),(0,a.jsx)("button",{onClick:async()=>{if(o.trim()){h("");try{await m.A.post("".concat(b,"/api/tags"),{name:o.trim(),eventId:t}),l(""),v()}catch(s){var e,n;h((null===(e=s.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.error)||"Failed to add tag")}}},className:"bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700",children:"Add"})]}),p?(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:"Loading tags..."}):(0,a.jsx)("ul",{className:"space-y-2",children:r.map((e=>(0,a.jsx)("li",{className:"flex items-center gap-2",children:d===e._id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),maxLength:20,className:"border px-2 py-1 rounded text-sm"}),(0,a.jsx)("button",{onClick:()=>(async e=>{if(u.trim()){h("");try{await m.A.put("".concat(b,"/api/tags/").concat(e),{name:u.trim()}),c(null),x(""),v()}catch(s){var t,n;h((null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||"Failed to edit tag")}}})(e._id),className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"Save"}),(0,a.jsx)("button",{onClick:()=>{c(null),x("")},className:"bg-gray-300 text-gray-700 px-2 py-1 rounded text-xs",children:"Cancel"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"inline-block bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full text-xs font-medium",children:["#",e.name]}),(0,a.jsx)("button",{onClick:()=>{c(e._id),x(e.name)},className:"text-xs text-blue-600 hover:underline",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>(async e=>{h("");try{await m.A.delete("".concat(b,"/api/tags/").concat(e)),v()}catch(t){h("Failed to delete tag")}})(e._id),className:"text-xs text-red-600 hover:underline",children:"Delete"})]})},e._id)))})]}):null},w=()=>{const{eventId:e}=(0,r.g)(),t=(0,r.Zp)(),{data:n=[],isLoading:s,isError:m}=(0,u.I)({queryKey:["events"],queryFn:g}),b=n.find((t=>{const n=t._id||t.id;return String(n)===String(e)})),w=y((e=>e.activeTab)),N=y((e=>e.setActiveTab)),{data:k="",isLoading:S}=h(e),{data:C=[],isLoading:I}=(0,u.I)({queryKey:["eventTabs"],queryFn:p}),{data:A=[],isLoading:T}=(0,f.B)(e),{data:_=[],isLoading:L}=v(e),E=(0,x.n)((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t._id})),q=A.find((e=>(e.userId||e.id)===E)),D="admin"===(null===q||void 0===q?void 0:q.role);if(s)return(0,a.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Loading event..."});if(m||!b)return(0,a.jsx)("div",{className:"p-4 text-center text-red-500",children:"Event not found."});return(0,a.jsxs)("div",{className:"bg-white min-h-screen flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border-b border-gray-100 sticky top-0 bg-white z-20 shadow-sm",children:[(0,a.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-100 focus:outline-none",onClick:()=>t(-1),"aria-label":"Back",type:"button",children:(0,a.jsx)("svg",{width:"28",height:"28",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("img",{src:b.thumbnail||b.imageUrl||b.event_image||"/default-group.png",alt:b.title||b.eventName||"Event",className:"w-10 h-10 rounded-full object-cover border border-gray-200 bg-gray-50"}),(0,a.jsx)("span",{className:"font-semibold text-base text-primary truncate",children:b.title||b.eventName})]}),S?(0,a.jsx)("div",{className:"p-4 text-gray-500",children:"Loading bio..."}):(0,a.jsx)(i,{bio:k}),I?(0,a.jsx)("div",{className:"p-4 text-gray-500",children:"Loading tabs..."}):(0,a.jsx)(o,{activeTab:w,setActiveTab:e=>{N(e)},tabs:C.filter((e=>"chat"!==e.key))}),(0,a.jsxs)("div",{className:"flex-1",children:[D&&(0,a.jsx)(j,{eventId:e,isAdmin:D}),"members"===w&&(T?(0,a.jsx)("div",{className:"p-4 text-gray-500",children:"Loading members..."}):(0,a.jsx)(l.A,{members:A,event:b})),"announcements"===w&&(L?(0,a.jsx)("div",{className:"p-4 text-gray-500",children:"Loading announcements..."}):(0,a.jsx)(c,{announcements:_})),"about"===w&&(0,a.jsx)(d.A,{event:b})]})]})}},7040:(e,t,n)=>{n.d(t,{A:()=>A});var s=n(9643),r=n(7192);const a=["text-indigo-600","text-blue-600","text-emerald-600","text-amber-600","text-rose-600","text-violet-600","text-cyan-600","text-fuchsia-600","text-teal-600","text-orange-600"],i=e=>{if(!e)return a[0];let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;const n=Math.abs(t)%a.length;return a[n]};var o=n(6507);const l=(0,s.forwardRef)(((e,t)=>{let{message:n,isOwn:r,userPhoto:a,onDelete:l,onReplyTo:d,onResend:c}=e;const u=(0,s.useMemo)((()=>r?"me":n.senderId||("object"===typeof n.sender?n.sender._id||n.sender.id:n.sender)||n.senderName||"unknown"),[r,n]),m=(0,s.useMemo)((()=>i(u)),[u]),[x,g]=(0,s.useState)(null),h=(0,s.useRef)(),[p,f]=(0,s.useState)(!1),[v,y]=(0,s.useState)(!1);function b(e){if(!e)return null;const t=/(@[a-zA-Z0-9_\- ]+)|(#\w+)|(https?:\/\/[\w\-._~:/?#[\]@!$&'()*+,;=%]+)|(www\.[\w\-._~:/?#[\]@!$&'()*+,;=%]+)/g,n=[];let s,r=0,a=0;for(;null!==(s=t.exec(e));){if(s.index>r&&n.push(e.slice(r,s.index)),s[1])n.push((0,o.jsx)("span",{className:"inline-block bg-yellow-100 text-yellow-800 px-1.5 py-0.5 rounded-full text-xs font-semibold mx-0.5",children:s[1]},a++));else if(s[2])n.push((0,o.jsx)("span",{className:"inline-block bg-indigo-100 text-indigo-700 px-1.5 py-0.5 rounded-full text-xs font-semibold mx-0.5",children:s[2]},a++));else if(s[3]||s[4]){let e=s[3]||s[4];e&&!/^https?:\/\//.test(e)&&(e="http://"+e),n.push((0,o.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline break-all hover:text-blue-800",children:s[3]||s[4]},a++))}r=s.index+s[0].length}return r<e.length&&n.push(e.slice(r)),n}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-end mb-2 w-full ".concat(r?"justify-end":"justify-start"),children:[!r&&(a?(0,o.jsx)("img",{src:a,alt:"Member",className:"w-8 h-8 rounded-full object-cover border border-gray-200 bg-gray-50 mr-2",style:{order:0}}):(0,o.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-indigo-100 text-indigo-800 text-xs font-bold border border-gray-200 mr-2",style:{order:0},children:(e=>{if(!e)return"?";const t=e.split(" ");return t.length>=2?"".concat(t[0].charAt(0)).concat(t[t.length-1].charAt(0)).toUpperCase():e.charAt(0).toUpperCase()})(n.senderName||"object"===typeof n.sender&&(n.sender.name||n.sender.username||n.sender.email||"")||n.sender||"Unknown")})),(0,o.jsxs)("div",{className:"flex flex-col gap-1 max-w-[85%] relative",style:{order:1},children:[n.replyTo&&(0,o.jsxs)("div",{className:"flex items-center gap-2 rounded-lg px-2 py-1 text-xs w-auto cursor-pointer hover:bg-opacity-80 shadow-sm border-l-4 ".concat(r?"bg-indigo-50 border-indigo-400 ml-auto":"bg-gray-100 border-gray-300 mr-auto"),style:{minHeight:36,maxWidth:"95%"},onClick:e=>{e.stopPropagation();const t=n.replyTo.messageId;t&&"function"===typeof d&&d(null,t)},children:[(0,o.jsxs)("div",{className:"flex flex-col w-full overflow-hidden",children:[(0,o.jsx)("span",{className:"font-semibold text-indigo-700 truncate max-w-[120px]",children:n.replyTo.senderName||"object"===typeof n.replyTo.sender&&(n.replyTo.sender.name||n.replyTo.sender.username)||"Unknown"}),(0,o.jsx)("span",{className:"text-[11px] text-gray-600 whitespace-pre-line break-words",children:n.replyTo.text||n.replyTo.content||"[deleted]"})]}),(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"ml-1 text-gray-400 flex-shrink-0",children:[(0,o.jsx)("polyline",{points:"9 17 4 12 9 7"}),(0,o.jsx)("path",{d:"M20 18v-2a4 4 0 0 0-4-4H4"})]})]}),(0,o.jsxs)("div",{className:"rounded-lg px-3 py-2 shadow-sm max-w-[85vw] break-words whitespace-pre-line relative text-[13px] leading-snug bg-gray-100 text-gray-900","aria-label":r?"Your message":"Member message",onContextMenu:e=>{!r||n.isDeleted||n.deleted||(e.preventDefault(),f(!0))},onTouchStart:()=>{!r||n.isDeleted||n.deleted||g(setTimeout((()=>{f(!0)}),600))},onTouchEnd:()=>{clearTimeout(x),g(null)},ref:e=>{h.current=e,"function"===typeof t?t(e):t&&(t.current=e)},onClick:e=>{e.stopPropagation(),n.isDeleted||n.deleted||d&&d(n)},children:[(0,o.jsx)("div",{className:"text-[11px] mb-1 font-medium ".concat(r?"text-right text-gray-600":"text-left ".concat(m)),children:r?"You":n.senderName||"object"===typeof n.sender&&(n.sender.name||n.sender.username||n.sender.email||n.sender._id||n.sender.id)||n.sender||"Unknown"}),(0,o.jsx)("div",{children:n.isDeleted||n.deleted?(0,o.jsx)("span",{className:"italic text-gray-400",children:"This message was deleted"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"break-words",children:v||(n.text||"").length<=300?b(n.text):b((n.text||"").slice(0,300)+"...")}),(n.text||"").length>300&&(0,o.jsxs)("button",{className:"ml-2 inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-gray-100 text-blue-600 hover:bg-blue-50 hover:text-blue-800 transition-colors border border-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-200",style:{verticalAlign:"middle"},"aria-expanded":v,onClick:e=>{e.stopPropagation(),y((e=>!e))},children:[v?"Show less":"Read more",(0,o.jsx)("svg",{className:"w-3 h-3 transition-transform duration-200 ".concat(v?"rotate-180":""),fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]})}),(0,o.jsxs)("div",{className:"text-xs mt-1 text-right flex items-center gap-1 justify-end ".concat(r?"text-gray-600":"text-gray-500"),children:[new Date(n.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),r&&!(n.isDeleted||n.deleted)&&(n.pending||"pending"===n.status?(0,o.jsx)("div",{className:"blinking-dot"}):(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-indigo-500",fill:"currentColor",viewBox:"0 0 16 16",children:(0,o.jsx)("path",{d:"M13.485 1.929a.75.75 0 010 1.06L6.06 10.414a.75.75 0 01-1.06 0L2.515 7.93a.75.75 0 111.06-1.06l2.004 2.003 6.36-6.36a.75.75 0 011.06 0z"})})),r&&"failed"===n.status&&(0,o.jsx)("button",{className:"ml-2 text-xs text-red-600 bg-white rounded px-2 py-0.5 border border-red-200 shadow hover:bg-red-50",onClick:()=>c&&c(n),title:"Resend message",children:"Resend"})]})]})]})]}),p&&(0,o.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-xs w-full",children:[(0,o.jsx)("div",{className:"text-base font-semibold mb-4 text-gray-800",children:"Delete this message?"}),(0,o.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,o.jsx)("button",{className:"px-3 py-1 rounded text-gray-600 hover:bg-gray-100",onClick:()=>f(!1),children:"Cancel"}),(0,o.jsx)("button",{className:"px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700",onClick:()=>{f(!1),l&&l(n._id)},children:"Delete"})]})]})})]})})),d=e=>{let{typingUsers:t,currentUserId:n}=e;const s=t.filter((e=>e.id!==n));if(0===s.length)return null;return(0,o.jsxs)("div",{className:"flex items-center px-4 py-2 text-sm bg-white bg-opacity-90 backdrop-filter backdrop-blur-sm border border-slate-200 rounded-full transition-all duration-300 ease-in-out shadow-glass",children:[(0,o.jsxs)("div",{className:"typing-indicator mr-2",children:[(0,o.jsx)("span",{}),(0,o.jsx)("span",{}),(0,o.jsx)("span",{})]}),1===s.length?(0,o.jsxs)("span",{className:"text-gray-600",children:[(0,o.jsx)("span",{className:"font-medium text-indigo-600",children:s[0].name})," is typing"]}):2===s.length?(0,o.jsxs)("span",{className:"text-gray-600",children:[(0,o.jsx)("span",{className:"font-medium text-indigo-600",children:s[0].name})," and"," ",(0,o.jsx)("span",{className:"font-medium text-indigo-600",children:s[1].name})," are typing"]}):(0,o.jsxs)("span",{className:"text-gray-600",children:[(0,o.jsxs)("span",{className:"font-medium text-indigo-600",children:[s.length," people"]})," are typing"]})]})};var c=n(5038),u=n(5936),m=n(2768),x=n(5432),g=n(6078),h=n(4600);const p="".concat("http://localhost:3020","/api/messages"),f=e=>"chat-".concat(e);function v(e){const[t,n]=(0,s.useState)([]),[r,a]=(0,s.useState)([]),i=(0,s.useRef)(null),o=(0,x.n)((e=>e.user)),l=(0,s.useRef)(!1);(0,s.useEffect)((()=>{if(e)return m.A.get("".concat(p,"/").concat(e)).then((e=>{const t=Array.isArray(e.data)?e.data.map((e=>(0,c.A)((0,c.A)({},e),{},{sender:e.sender||e.senderId||e.userId||"",_senderId:String(e.sender||e.senderId||e.userId||"").trim(),replyTo:e.replyTo?(0,c.A)((0,c.A)({},e.replyTo),{},{sender:e.replyTo.sender||e.replyTo.senderId||"",_senderId:String(e.replyTo.sender||e.replyTo.senderId||"").trim()}):null}))):[];n(t)})).catch((()=>n([]))),()=>n([])}),[e]),(0,s.useEffect)((()=>{if(!e)return;const t=sessionStorage.getItem(f(e));if(t)try{n(JSON.parse(t))}catch(s){}}),[e]),(0,s.useEffect)((()=>{if(!e||!o)return;const t=(0,u.io)("http://localhost:3020");return i.current=t,t.emit("joinEvent",e),t.on("typingStatus",(e=>{let{users:t}=e;Array.isArray(t)&&a(t)})),t.on("newMessage",(s=>{if(!s)return;const r=(0,c.A)((0,c.A)({},s),{},{sender:s.sender||s.senderId||s.userId||"",_senderId:String(s.sender||s.senderId||s.userId||"").trim(),replyTo:s.replyTo?(0,c.A)((0,c.A)({},s.replyTo),{},{sender:s.replyTo.sender||s.replyTo.senderId||"",_senderId:String(s.replyTo.sender||s.replyTo.senderId||"").trim()}):null});n((e=>{if(e.some((e=>s._id&&e._id===s._id||s.id&&e.id===s.id||e._senderId===r._senderId&&e.text===s.text&&Math.abs(new Date(e.timestamp||e.createdAt||Date.now())-new Date(s.timestamp||s.createdAt||Date.now()))<5e3)))return e;const t=e.findIndex((e=>e.pending&&e._id.startsWith("temp-")));return-1!==t&&r.senderId===o._id?[...e.slice(0,t),r,...e.slice(t+1)]:[...e,r]})),s&&s._id&&s.senderId!==(null===o||void 0===o?void 0:o._id)&&t.emit("deliveredAck",{eventId:e,messageId:s._id})})),t.on("messageDeleted",(e=>{let{messageId:t}=e;n((e=>e.map((e=>e._id===t||e.id===t?(0,c.A)((0,c.A)({},e),{},{isDeleted:!0,deleted:!0,text:""}):e))))})),t.on("sentAck",(e=>{const t=e?(0,c.A)((0,c.A)({},e),{},{sender:e.sender||e.senderId||e.userId||"",_senderId:String(e.sender||e.senderId||e.userId||"").trim(),replyTo:e.replyTo?(0,c.A)((0,c.A)({},e.replyTo),{},{sender:e.replyTo.sender||e.replyTo.senderId||"",_senderId:String(e.replyTo.sender||e.replyTo.senderId||"").trim()}):null}):null;t&&t.clientMsgId&&n((e=>{const n=e.findIndex((e=>e.clientMsgId&&e.clientMsgId===t.clientMsgId));if(-1!==n){const s=[...e];return s[n]=(0,c.A)((0,c.A)({},t),{},{pending:!1,status:"sent"}),s}return[...e,t]}))})),t.on("statusUpdate",(e=>{let{messageId:t,status:s}=e;t&&s&&n((e=>e.map((e=>e._id===t||e.id===t?(0,c.A)((0,c.A)({},e),{},{status:s}):e))))})),()=>{t.off("messageDeleted"),t.off("sentAck"),t.off("statusUpdate"),t.off("typingStatus"),t.disconnect()}}),[e,o]);const d=(0,s.useCallback)((function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!i.current||!o||!t.trim())return;const r=(0,g.v4)(),a=s?{messageId:s._id||s.id,senderId:s.senderId||s.sender,senderName:s.senderName,text:s.text}:null,l={_id:"temp-".concat(r),eventId:e,sender:o._id,senderId:o._id,_senderId:String(o._id).trim(),senderName:o.name,senderAvatar:o.avatar,text:t,clientMsgId:r,replyTo:a,timestamp:(new Date).toISOString(),pending:!0,status:"pending"};n((e=>[...e,l])),i.current.emit("sendMessage",{eventId:e,sender:o._id,senderId:o._id,senderName:o.name,senderAvatar:o.avatar,text:t,replyTo:a,clientMsgId:r})}),[e,o]),v=(0,s.useCallback)((t=>{i.current&&t&&i.current.emit("deleteMessage",{eventId:e,messageId:t})}),[e]);(0,s.useEffect)((()=>{if(e)try{sessionStorage.setItem(f(e),JSON.stringify(t))}catch(n){}}),[t,e]);const y=(0,s.useRef)(null);(0,s.useEffect)((()=>{const e=(0,h.debounce)(((e,t,n,s,r)=>{e&&null!==r&&void 0!==r&&r.current&&(e.emit("typing",{eventId:t,userId:n,userName:s,isTyping:!1}),r&&(r.current=!1))}),2e3);return y.current=e,()=>{var e;null!==(e=y.current)&&void 0!==e&&e.cancel&&y.current.cancel()}}),[]);const b=(0,s.useCallback)((()=>{i.current&&o&&l.current&&y.current&&y.current(i.current,e,null===o||void 0===o?void 0:o._id,null===o||void 0===o?void 0:o.name,l)}),[e,o]),j=(0,s.useCallback)((t=>{if(i.current&&o)if(t&&!l.current&&(i.current.emit("typing",{eventId:e,userId:o._id,userName:o.name,isTyping:!0}),l.current=!0),t)b();else if(l.current){var n;null!==(n=y.current)&&void 0!==n&&n.cancel&&y.current.cancel(),i.current.emit("typing",{eventId:e,userId:o._id,userName:o.name,isTyping:!1}),l.current=!1}}),[e,o,b]),w=(0,s.useCallback)((async()=>{if(i.current&&o&&e)try{await m.A.post("".concat(p,"/").concat(e,"/read"),{userId:o._id}),n((e=>e.map((e=>{if(String(e.senderId)===String(o._id))return e;return e.readBy&&e.readBy.some((e=>String(e.userId)===String(o._id)))?e:(0,c.A)((0,c.A)({},e),{},{readBy:[...e.readBy||[],{userId:o._id,readAt:new Date}]})})))),i.current.emit("messagesRead",{eventId:e,userId:o._id}),i.current.emit("unreadCountsChanged",{eventId:e})}catch(t){}}),[e,o,n]);return{messages:t,sendMessage:d,deleteMessage:v,setMessages:n,typingUsers:r,updateTypingStatus:j,markMessagesAsRead:w}}n(9668);const y=e=>{let{messages:t,currentUserId:n,eventId:r,onReplyTo:a,typingUsers:i=[],unreadCount:c=0}=e;const{deleteMessage:u,sendMessage:m,setMessages:x,markMessagesAsRead:g}=v(r),h=(0,s.useRef)(null),[p,f]=(0,s.useState)(!0),y=(0,s.useRef)({}),b=(0,s.useRef)(0),j=(0,s.useRef)(!0),[w,N]=(0,s.useState)(!1),[k,S]=(0,s.useState)(null),[C,I]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(!t||0===t.length)return;const e=t.length>b.current;if(b.current=t.length,e&&h.current){const e=()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)};e(),setTimeout(e,50),setTimeout(e,150)}}),[t]),(0,s.useEffect)((()=>{j.current=!0,N(!1),S(null),I(!1),y.current={},b.current=0}),[r]),(0,s.useLayoutEffect)((()=>{if(h.current&&Array.isArray(t)&&0!==t.length){if(j.current&&c>0&&!w){const e=t.filter((e=>{if(String(e.senderId)===String(n))return!1;return!(e.readBy&&e.readBy.some((e=>String(e.userId)===String(n))))}));if(e.length>0){e.sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)));const t=e[0];S(t._id),I(!0);const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;y.current[t._id]?(y.current[t._id].scrollIntoView({behavior:"auto",block:"center"}),y.current[t._id].classList.add("bg-yellow-100"),setTimeout((()=>{y.current[t._id]&&y.current[t._id].classList.remove("bg-yellow-100")}),2e3),N(!0),setTimeout((()=>{g(r)}),1e3)):e<5?setTimeout((()=>n(e+1)),100*Math.pow(2,e)):h.current.scrollTop=h.current.scrollHeight};n()}else h.current.scrollTop=h.current.scrollHeight}else j.current&&(h.current.scrollTop=h.current.scrollHeight);j.current=!1}}),[t,c,n,r,w,g]),(0,s.useEffect)((()=>{const e=window.visualViewport;if(!e)return;const t=()=>{p&&h.current&&(h.current.scrollTop=h.current.scrollHeight)};return e.addEventListener("resize",t),()=>e.removeEventListener("resize",t)}),[p]);const A=e=>{const t=new Date(e),n=new Date,s=new Date(n);s.setDate(s.getDate()-1);const r=new Date(n.getFullYear(),n.getMonth(),n.getDate()),a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());return i.getTime()===r.getTime()?"Today":i.getTime()===a.getTime()?"Yesterday":t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:t.getFullYear()!==n.getFullYear()?"numeric":void 0})},T=(e=>{if(!Array.isArray(e)||0===e.length)return[];const t=[];let n=null,s=[];return e.forEach((e=>{const r=new Date(e.timestamp||e.createdAt||Date.now()),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toISOString();a!==n?(s.length>0&&t.push({date:n,messages:s}),n=a,s=[e]):s.push(e)})),s.length>0&&t.push({date:n,messages:s}),t})(t),_=e=>{x((t=>t.filter((t=>t._id!==e._id)))),m(e.text,e.replyTo)};return(0,o.jsxs)("div",{ref:h,onScroll:()=>{const e=h.current||document.documentElement,{scrollTop:t,scrollHeight:n,clientHeight:s}=e;f(n-(t+s)<100)},className:"flex flex-col gap-1 w-full pb-16 overflow-y-auto flex-1 relative chat-scrollbar",style:{scrollPaddingBottom:"90px"},children:[(0,o.jsx)("div",{className:"w-full px-3 pt-2 pb-1",children:(0,o.jsx)("div",{className:"w-full bg-white/90 backdrop-blur-sm rounded-xl shadow-sm p-3 border border-gray-100",children:(0,o.jsxs)("div",{className:"flex flex-col gap-1 justify-center text-center text-gray-700",children:[(0,o.jsx)("div",{className:"flex items-center justify-center gap-1",children:(0,o.jsx)("span",{className:"text-sm font-medium",children:"\ud83d\udd12 All messages are end\u2011to\u2011end encrypted"})}),(0,o.jsx)("div",{className:"flex items-center justify-center gap-1",children:(0,o.jsx)("span",{className:"text-sm font-medium",children:"\ud83d\udcac Single Tap to Reply"})}),(0,o.jsx)("div",{className:"flex items-center justify-center gap-1",children:(0,o.jsx)("span",{className:"text-sm font-medium",children:"\u274c Long\u2011Press to Delete your message"})})]})})}),T.length>0?T.map(((e,t)=>(0,o.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,o.jsx)("div",{className:"sticky top-0 z-10 flex justify-center my-2",children:(0,o.jsx)("div",{className:"bg-white bg-opacity-80 backdrop-blur-sm text-xs text-gray-500 px-3 py-1 rounded-full shadow-sm",children:A(e.date)})}),e.messages.map(((e,t)=>{let s="";s=void 0===e.sender||null===e.sender?"":"object"===typeof e.sender?e.sender._id||e.sender.id||e.sender.username||e.sender.email||"":e.sender;const r=e._senderId?e._senderId===String(n).trim():String(s).trim()===String(n).trim();return(0,o.jsxs)("div",{ref:t=>y.current[e._id]=t,className:"w-full",children:[C&&k===e._id&&(0,o.jsx)("div",{className:"flex items-center justify-center my-2",children:(0,o.jsxs)("div",{className:"bg-red-100 text-red-600 text-xs px-4 py-1 rounded-full font-medium shadow-sm animate-pulse",children:["Unread Messages (",c,")"]})}),(0,o.jsx)(l,{message:e,isOwn:r,userPhoto:e.senderAvatar||e.avatar||e.photo||void 0,onDelete:u,onReplyTo:(e,t)=>{t?(e=>{if(y.current[e]&&h.current){const t=y.current[e];t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("bg-yellow-100"),setTimeout((()=>{t.classList.remove("bg-yellow-100")}),1500)}})(t):a&&a(e)},onResend:_})]},e._id)}))]},e.date||"group-".concat(t)))):(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,o.jsxs)("p",{className:"text-center font-medium",children:["No messages yet.",(0,o.jsx)("br",{}),"Start the conversation!"]})]}),!p&&(0,o.jsx)("button",{type:"button",className:"fixed left-4 bottom-36 bg-indigo-600 text-white p-2 rounded-full shadow-lg hover:bg-indigo-700 focus:outline-none z-40 flex items-center justify-center",onClick:()=>{const e=h.current||document.documentElement;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},"aria-label":"Scroll to latest",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,o.jsx)("polyline",{points:"6 9 12 15 18 9"})})}),i&&i.length>0&&(0,o.jsx)("div",{className:"sticky bottom-0 w-full z-10 animate-fadeIn",children:(0,o.jsx)("div",{className:"mx-2 mb-2 rounded-full shadow-sm overflow-hidden transform transition-all duration-300 ease-in-out",children:(0,o.jsx)(d,{typingUsers:i,currentUserId:n})})}),(0,o.jsx)("div",{className:"h-20 w-full flex-shrink-0 pb-16",id:"chat-end-spacer","aria-hidden":"true"})]})},b=e=>{let{onSend:t,value:n,onChange:r,replyToMessage:a,onCancelReply:i,onTyping:l,eventId:d,members:c=[]}=e;const u=(0,s.useRef)(),[x,g]=(0,s.useState)(!1),[h,p]=(0,s.useState)([]),[f,v]=(0,s.useState)(!1),[,y]=(0,s.useState)(""),[b,j]=(0,s.useState)([]),[w,N]=(0,s.useState)(!1),[,k]=(0,s.useState)(""),[S,C]=(0,s.useState)([]),I=()=>{const e=u.current;if(!e)return;e.style.height="auto";const t=Math.min(e.scrollHeight,120);e.style.height="".concat(t,"px")};(0,s.useEffect)((()=>{d&&m.A.get("".concat("http://localhost:3020","/api/tags?eventId=").concat(d)).then((e=>p(e.data))).catch((e=>{}))}),[d]),(0,s.useEffect)((()=>{I()}),[n]),(0,s.useEffect)((()=>{u.current&&n&&I()}),[]);const A=e=>{e&&e.preventDefault(),n&&n.trim()&&t(n)},T=e=>{(e=>{const t=u.current,s="#".concat(e.name);if(t){const e=t.selectionStart,a=t.selectionEnd,i=(n||"").slice(0,e),o=(n||"").slice(a);let l=i;w?l=i.replace(/#[a-zA-Z0-9_-]*$/,""):i&&!/\s$/.test(i)&&(l=i+" ");const d=s+" ";r(l+d+o),setTimeout((()=>{t.focus(),t.selectionStart=t.selectionEnd=l.length+d.length}),0)}else r((n||"")+s);N(!1)})(e)};return(0,o.jsxs)("div",{className:"flex w-full gap-2 items-end p-2 border-t border-gray-200 bg-white relative flex-col",children:[a&&(0,o.jsxs)("div",{className:"w-full mb-2 p-2 rounded bg-gray-100 border-l-4 border-blue-400",children:[(0,o.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Replying to:"}),(0,o.jsx)("div",{className:"text-sm text-gray-800 whitespace-pre-line break-words",children:a.content||a.text||""}),(0,o.jsx)("button",{type:"button",className:"mt-1 text-xs text-blue-600 hover:underline focus:outline-none",onClick:i,children:"Cancel Reply"})]}),(0,o.jsxs)("div",{className:"flex w-full gap-2 items-start",children:[(0,o.jsx)("textarea",{ref:u,className:"flex-1 min-w-0 px-2 py-1 rounded-2xl border border-gray-300 text-base focus:outline-none resize-none min-h-[28px] overflow-auto chat-input",placeholder:"Type a message...",value:n,maxLength:1500,rows:1,onChange:e=>{const t=e.target.value;r(t),x&&g(!1);const n=u.current;if(n){const e=n.selectionStart,s=t.slice(0,e),r=s.match(/@([a-zA-Z0-9_\- ]*)$/);if(r){const e=r[1]||"";y(e);const t=c.filter((t=>(t.name||t.username||"").toLowerCase().includes(e.toLowerCase())));j(t.slice(0,8)),v(!0),N(!1)}else{v(!1),y("");const e=s.match(/#([a-zA-Z0-9_-]*)$/);if(e){const t=e[1]||"";k(t);const n=h.filter((e=>e.name.toLowerCase().includes(t.toLowerCase())));C(n.slice(0,5)),N(!0)}else N(!1),k("")}}l&&l(t.length>0),I()},onBlur:()=>{l&&l(!1)},onKeyDown:e=>{if("Enter"!==e.key||e.shiftKey)"Enter"===e.key&&e.shiftKey&&setTimeout(I,0);else{const t=e.target,n=t.selectionStart,s=t.value,r=s.slice(0,n),a=s.slice(n),i=r.split("\n");""===i[i.length-1].trim()&&""===a.trim()?(e.preventDefault(),A(e)):setTimeout(I,0)}},style:{lineHeight:"1.5",overflow:"hidden"}}),(0,o.jsx)("button",{className:"btn btn-primary flex-shrink-0 inline-flex items-center justify-center w-10 h-10 rounded-full p-0 self-end",style:{display:"grid",placeItems:"center"},onTouchStart:e=>{e.preventDefault()},onMouseDown:e=>{e.preventDefault()},onClick:e=>{A(e)},type:"button","aria-label":"Send message",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,o.jsx)("path",{d:"M12 19V5M5 12l7-7 7 7"})})})]}),f&&b.length>0&&(0,o.jsx)("div",{className:"absolute left-12 bottom-14 z-50 bg-white border border-gray-200 rounded shadow-lg min-w-[180px] max-h-48 overflow-y-auto p-1",children:b.map((e=>(0,o.jsxs)("button",{className:"w-full text-left px-3 py-1 hover:bg-indigo-100 rounded text-sm text-gray-800 flex items-center gap-2",type:"button",onClick:()=>(e=>{const t=u.current,s="@".concat(e.name);if(t){const e=t.selectionStart,a=t.selectionEnd,i=(n||"").slice(0,e).replace(/@([a-zA-Z0-9_\- ]*)$/,""),o=(n||"").slice(a),l=s+" ";r(i+l+o),setTimeout((()=>{t.focus(),t.selectionStart=t.selectionEnd=i.length+l.length}),0)}else r((n||"")+s+" ");v(!1),y("")})(e),children:[e.avatar&&(0,o.jsx)("img",{src:e.avatar,alt:e.name,className:"w-6 h-6 rounded-full object-cover"}),(0,o.jsx)("span",{className:"font-medium",children:e.name}),e.username&&(0,o.jsxs)("span",{className:"text-xs text-gray-500",children:["@",e.username]})]},e.userId||e.id||e._id)))}),w&&S.length>0&&(0,o.jsx)("div",{className:"absolute left-12 bottom-14 z-50 bg-white border border-gray-200 rounded shadow-lg min-w-[150px] max-h-48 overflow-y-auto p-1",children:S.map((e=>(0,o.jsx)("button",{className:"w-full text-left px-3 py-1 hover:bg-indigo-100 rounded text-sm flex items-center gap-2",type:"button",onClick:()=>T(e),children:(0,o.jsxs)("span",{className:"inline-block bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full text-xs font-medium",children:["#",e.name]})},e._id)))}),a&&(0,o.jsxs)("div",{className:"absolute left-0 right-0 bottom-full bg-gray-50 border-t border-gray-200 px-3 py-2 flex justify-between items-center",children:[(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,o.jsxs)("div",{className:"text-xs text-gray-500",children:["Replying to ",(0,o.jsx)("span",{className:"font-medium text-gray-700",children:a.senderName||"object"===typeof a.sender&&(a.sender.name||a.sender.username)||"Unknown"})]}),(0,o.jsx)("div",{className:"text-sm text-gray-700 mt-1 max-h-20 overflow-y-auto break-words whitespace-pre-wrap",children:a.text||"[deleted]"})]}),(0,o.jsx)("button",{onClick:i,className:"ml-2 p-1 text-gray-500 hover:text-gray-700 rounded-full hover:bg-gray-200","aria-label":"Cancel reply",children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,o.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]})};var j=n(4356),w=n(4325),N=n(2610),k=n(5224),S=n(8979),C=n(2775),I=n(3075);const A=()=>{(0,s.useEffect)((()=>{let e=document.querySelector('meta[name="viewport"]');return e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",()=>{e.content="width=device-width, initial-scale=1.0"}}),[]);const[e,t]=(0,s.useState)("groupinfo"),[n,a]=(0,s.useState)(!1),i=(0,s.useRef)(null),{eventId:l}=(0,r.g)(),d=(0,r.Zp)(),{user:c}=(0,x.n)(),{data:u=[]}=(0,S.nI)(),{data:m=[]}=(0,C.B)(l),{preview:g}=(0,I.W)(l),h=(null===g||void 0===g?void 0:g.unreadCount)||0,p=u.find((e=>{const t=e._id||e.id;return String(t)===String(l)})),{messages:f,sendMessage:A,typingUsers:T,updateTypingStatus:_,markMessagesAsRead:L}=v(l),[E,q]=(0,s.useState)(""),[D,M]=(0,s.useState)(null);(0,s.useEffect)((()=>{if(f&&f.length>0&&i.current){const e=()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)};e(),setTimeout(e,100),setTimeout(e,300)}}),[f]),(0,s.useEffect)((()=>{if(!l)return;L();const e=()=>L();return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[l,L]);(0,s.useEffect)((()=>{const e=document.createElement("style");return e.innerHTML="\n      .chat-background-container {\n        position: relative;\n        width: 100%;\n        padding-left: 0;\n        padding-right: 0;\n        margin-left: auto;\n        margin-right: auto;\n        overflow-x: hidden;\n        background-color: #ffffff;\n      }\n      \n      .chat-header-container {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        z-index: 40;\n        max-width: 600px;\n        width: 100%;\n        margin: 0 auto;\n        transition: all 0.3s ease;\n      }\n      \n      .chat-header-glass {\n        background-color: rgba(255, 255, 255, 0.8);\n        backdrop-filter: blur(10px);\n        border-bottom-left-radius: 16px;\n        border-bottom-right-radius: 16px;\n        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n        padding: 12px;\n        transition: all 0.3s ease;\n      }\n      \n      .chat-header-content {\n        display: flex;\n        align-items: center;\n        justify-content: flex-start;\n        gap: 12px;\n        width: 100%;\n        padding: 0 4px;\n      }\n      \n      .chat-input-container {\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        z-index: 40;\n        max-width: 600px;\n        width: 100%;\n        margin: 0 auto;\n        transition: all 0.3s ease;\n      }\n      \n      .chat-input-glass {\n        background-color: rgba(255, 255, 255, 0.8);\n        backdrop-filter: blur(10px);\n        border-top-left-radius: 16px;\n        border-top-right-radius: 16px;\n        box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1), 0 -2px 4px -1px rgba(0, 0, 0, 0.06);\n        padding: 12px;\n        transition: all 0.3s ease;\n      }\n      \n      .chat-content-wrapper {\n        padding-left: 0;\n        padding-right: 0;\n        max-width: 100%;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}),[]),(0,s.useEffect)((()=>{const e=()=>{const e=document.querySelector(".chat-header-container"),t=document.querySelector(".chat-header-glass");e&&t&&(window.scrollY>10?(t.style.borderBottomLeftRadius="16px",t.style.borderBottomRightRadius="16px",t.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"):(t.style.borderBottomLeftRadius="0",t.style.borderBottomRightRadius="0",t.style.boxShadow="none"))};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]);const R=null===c||void 0===c?void 0:c._id,F=m.find((e=>(e.userId||e.id)===R)),z="admin"===(null===F||void 0===F?void 0:F.role),[B,P]=(0,s.useState)(null),U=B?f.filter((e=>e.text&&e.text.includes("#".concat(B.name)))):f,[W,K]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=()=>{W&&K(!1)},t=i.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}}),[W]);return n?(0,o.jsxs)("div",{className:"flex flex-col h-screen bg-white max-w-[600px] mx-auto relative",children:[(0,o.jsxs)("div",{className:"sticky top-0 z-40 bg-white border-b border-gray-100 p-3 flex items-center gap-3",children:[(0,o.jsx)("button",{className:"p-2 rounded hover:bg-gray-100 focus:outline-none",onClick:()=>a(!1),"aria-label":"Back to Chat",children:(0,o.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),(0,o.jsx)(j.A,{event:p,onClick:()=>{}})]}),(0,o.jsxs)("div",{className:"flex border-b border-gray-200 bg-white sticky top-16 z-30",children:[(0,o.jsx)("button",{className:"flex-1 py-3 text-sm font-medium focus:outline-none transition-colors ".concat("groupinfo"===e?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500"),onClick:()=>t("groupinfo"),children:"Group Info"}),(0,o.jsx)("button",{className:"flex-1 py-3 text-sm font-medium focus:outline-none transition-colors ".concat("moments"===e?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500"),onClick:()=>t("moments"),children:"Moments"}),(0,o.jsx)("button",{className:"flex-1 py-3 text-sm font-medium focus:outline-none transition-colors ".concat("members"===e?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500"),onClick:()=>t("members"),children:"Members"})]}),(0,o.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden pt-2",children:["groupinfo"===e&&(0,o.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,o.jsx)(k.A,{event:p})}),"moments"===e&&(0,o.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,o.jsx)(w.A,{eventId:l})}),"members"===e&&(0,o.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,o.jsx)(N.A,{members:m,event:p})})]})]}):(0,o.jsx)("div",{className:"flex flex-col h-screen bg-white relative chat-background-container",children:(0,o.jsxs)("div",{className:"max-w-[600px] mx-auto w-full flex flex-col h-full relative z-10 chat-content-wrapper",children:[(0,o.jsx)("div",{className:"chat-header-container",children:(0,o.jsx)("div",{className:"chat-header-glass",children:(0,o.jsxs)("div",{className:"chat-header-content",children:[(0,o.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-100 focus:outline-none flex-shrink-0",onClick:()=>d("/myevents"),"aria-label":"Back",type:"button",children:(0,o.jsx)("svg",{width:"28",height:"28",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),p&&(0,o.jsx)(j.A,{event:p,onClick:()=>a(!0),isAdmin:z,onTagFilter:e=>{if(P(e),e){const t="#".concat(e.name),n=E.trim();""===n?q(t+" "):n.startsWith(t)||q(t+" "+n),setTimeout((()=>{const e=document.querySelector(".chat-input");e&&e.focus()}),50)}},selectedTag:B,onTagClick:e=>{const t="#".concat(e.name),n=E.trim();if(""===n)q(t+" ");else{if(n.startsWith(t))return;q(t+" "+n)}setTimeout((()=>{const e=document.querySelector(".chat-input");e&&e.focus()}),50)},showTags:W,toggleShowTags:()=>K((e=>!e))})]})})}),(0,o.jsx)("div",{className:"pt-16"}),(0,o.jsx)("div",{className:"chat-content-wrapper flex flex-col flex-1 overflow-hidden",ref:i,children:(0,o.jsx)(y,{messages:U,currentUserId:null===c||void 0===c?void 0:c._id,otherPhoto:null===p||void 0===p?void 0:p.thumbnail,eventId:l,onReplyTo:e=>{var t;M(e),null===(t=document.querySelector("textarea"))||void 0===t||t.focus()},typingUsers:T,unreadCount:h})}),(0,o.jsx)("div",{className:"chat-input-container",children:(0,o.jsx)("div",{className:"chat-input-glass",children:(0,o.jsx)(b,{onSend:e=>{const t="string"===typeof e?e:String(e||"");t.trim()&&(A(t,D),q(B?"#".concat(B.name," "):""),M(null),i.current&&(i.current.scrollTop=i.current.scrollHeight))},value:E,onChange:q,replyToMessage:D,onCancelReply:()=>{M(null)},onTyping:_,eventId:l,members:m})})}),B&&(0,o.jsxs)("div",{className:"flex items-center gap-2 px-4 py-1 bg-indigo-50 border-b border-indigo-200 text-indigo-700 text-xs",children:[(0,o.jsx)("span",{children:"Filtering by tag:"}),(0,o.jsxs)("span",{className:"bg-indigo-200 text-indigo-800 px-2 py-0.5 rounded-full font-semibold",children:["#",B.name]}),(0,o.jsx)("button",{onClick:()=>{if(P(null),B){const e="#".concat(B.name),t=E.trim();t.startsWith(e)&&q(t.substring(e.length).trim())}},className:"ml-2 text-xs text-red-500 hover:underline",children:"Clear"})]})]})})}},7481:(e,t,n)=>{n.d(t,{A:()=>m});var s=n(9643),r=n(7192),a=n(4325),i=n(2610),o=n(5224),l=n(4356),d=n(8979),c=n(2775),u=n(6507);const m=()=>{const{eventId:e}=(0,r.g)(),[t,n]=(0,s.useState)("groupinfo"),{data:m=[]}=(0,d.nI)(),{data:x=[]}=(0,c.B)(e),g=m.find((t=>String(t._id||t.id)===String(e)));return(0,u.jsxs)("div",{className:"flex flex-col h-screen bg-white max-w-[600px] mx-auto relative",children:[(0,u.jsx)("div",{className:"sticky top-0 z-40 bg-white border-b border-gray-100 p-3 flex items-center",children:(0,u.jsx)(l.A,{event:g,onClick:()=>{}})}),(0,u.jsxs)("div",{className:"flex border-b border-gray-200 bg-white sticky top-16 z-30",children:[(0,u.jsx)("button",{className:"flex-1 py-3 text-sm font-medium focus:outline-none transition-colors ".concat("groupinfo"===t?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500"),onClick:()=>n("groupinfo"),children:"Group Info"}),(0,u.jsx)("button",{className:"flex-1 py-3 text-sm font-medium focus:outline-none transition-colors ".concat("moments"===t?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500"),onClick:()=>n("moments"),children:"Moments"}),(0,u.jsx)("button",{className:"flex-1 py-3 text-sm font-medium focus:outline-none transition-colors ".concat("members"===t?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500"),onClick:()=>n("members"),children:"Members"})]}),(0,u.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden pt-2",children:["groupinfo"===t&&(0,u.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,u.jsx)(o.A,{event:g})}),"moments"===t&&(0,u.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,u.jsx)(a.A,{eventId:e})}),"members"===t&&(0,u.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,u.jsx)(i.A,{members:x,event:g})})]})]})}},7927:(e,t,n)=>{n.d(t,{A:()=>o});n(9643);var s=n(7192),r=n(8979),a=n(5224),i=n(6507);const o=()=>{const{eventId:e}=(0,s.g)(),t=(0,s.Zp)(),{data:n=[],isLoading:o,isError:l}=(0,r.nI)(),d=n.find((t=>{const n=t._id||t.id;return String(n)===String(e)}));return o?(0,i.jsx)("div",{className:"flex flex-col min-h-screen bg-white max-w-[600px] mx-auto relative",children:(0,i.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Loading event details..."})}):l||!d?(0,i.jsx)("div",{className:"flex flex-col min-h-screen bg-white max-w-[600px] mx-auto relative",children:(0,i.jsx)("div",{className:"p-4 text-center text-red-500",children:"Failed to load event details."})}):(0,i.jsxs)("div",{className:"flex flex-col min-h-screen bg-white max-w-[600px] mx-auto relative",children:[(0,i.jsxs)("div",{className:"sticky top-0 z-40 bg-white border-b border-gray-100 p-3 flex items-center gap-3",children:[(0,i.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-100 focus:outline-none",onClick:()=>t(-1),"aria-label":"Back",type:"button",children:(0,i.jsx)("svg",{width:"28",height:"28",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("img",{src:d.thumbnail||d.imageUrl||d.event_image||"/default-group.png",alt:d.title||d.eventName||"Event",className:"w-10 h-10 rounded-full object-cover border border-gray-200 bg-gray-50"}),(0,i.jsx)("span",{className:"font-semibold text-base text-primary truncate",children:d.title||d.eventName||"Event"})]})]}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,i.jsx)(a.A,{event:d})})]})}},8979:(e,t,n)=>{n.d(t,{mn:()=>u,nH:()=>c,nI:()=>d,yC:()=>m,SZ:()=>x});var s=n(7109),r=n(8894),a=n(7027);const i=n(2768).A.create({baseURL:"http://localhost:3002",timeout:1e4,headers:{"Content-Type":"application/json"}});i.interceptors.request.use((e=>{const t=localStorage.getItem("auth-storage");let n=null;if(t)try{var s;n=null===(s=JSON.parse(t).state)||void 0===s?void 0:s.token}catch(r){}return n&&(e.headers.Authorization="Bearer ".concat(n)),e}),(e=>Promise.reject(e)));const o={getMyEvents:async e=>{try{return(await i.get("/events/myevents/".concat(e))).data.data}catch(t){throw t}},getEventsAttending:async e=>{try{return(await i.get("/events/attending/".concat(e))).data.data}catch(t){throw t}},getHostedEvents:async e=>{try{return(await i.get("/events/host/".concat(e))).data.data}catch(t){throw t}},getEventPendingRequests:async e=>{try{return(await i.get("/events/".concat(e,"/requests/pending"))).data.data}catch(t){throw t}},getPendingJoinRequests:async e=>{try{const t=e||localStorage.getItem("userId");return(await i.get("/events/requests/pending/".concat(t))).data.data}catch(t){throw t}},approveJoinRequest:async(e,t)=>{try{return(await i.post("/events/".concat(e,"/requests/").concat(t,"/approve"))).data.data}catch(n){throw n}},rejectJoinRequest:async(e,t)=>{try{return(await i.post("/events/".concat(e,"/requests/").concat(t,"/reject"))).data.data}catch(n){throw n}},removeAttendee:async(e,t)=>{try{return(await i.delete("/events/".concat(e,"/attendees"),{data:{userId:t}})).data.data}catch(n){throw n}}};var l=n(5432);const d=()=>{const{user:e}=(0,l.n)(),t=null===e||void 0===e?void 0:e._id;return(0,s.I)({queryKey:["myEvents",t],queryFn:()=>o.getMyEvents(t),enabled:!!t,staleTime:3e5,refetchOnWindowFocus:!1})},c=e=>(0,s.I)({queryKey:["eventPendingRequests",e],queryFn:()=>o.getEventPendingRequests(e),enabled:!!e,staleTime:6e4,refetchOnWindowFocus:!0}),u=()=>{const e=(0,r.jE)();return(0,a.n)({mutationFn:e=>{let{eventId:t,requestId:n}=e;return o.approveJoinRequest(t,n)},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["eventPendingRequests",n.eventId]}),e.invalidateQueries({queryKey:["pendingJoinRequests"]}),e.invalidateQueries({queryKey:["hostedEvents"]}),e.invalidateQueries({queryKey:["myEvents"]})}})},m=()=>{const e=(0,r.jE)();return(0,a.n)({mutationFn:e=>{let{eventId:t,requestId:n}=e;return o.rejectJoinRequest(t,n)},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["eventPendingRequests",n.eventId]}),e.invalidateQueries({queryKey:["pendingJoinRequests"]})}})},x=()=>{const e=(0,r.jE)();return(0,a.n)({mutationFn:e=>{let{eventId:t,userId:n}=e;return o.removeAttendee(t,n)},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["myEvents"]}),e.invalidateQueries({queryKey:["eventDetails",n.eventId]}),e.invalidateQueries({queryKey:["eventsAttending"]}),e.invalidateQueries({queryKey:["hostedEvents"]})}})}},9492:(e,t,n)=>{n.d(t,{A:()=>u});var s=n(9643),r=n(7192),a=n(8979),i=n(5432),o=n(4356),l=n(6507);const d=(e,t)=>{if(e){const t=e.split(" ");return t.length>=2?"".concat(t[0].charAt(0)).concat(t[t.length-1].charAt(0)).toUpperCase():e.substring(0,2).toUpperCase()}return t?t.substring(0,2).toUpperCase():"?"},c=e=>{let{request:t,onApprove:n,onReject:s,isProcessing:a}=e;const i=(0,r.Zp)();return(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>{t&&t.userId&&i("/profile/".concat(t.userId))},children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-indigo-100 text-indigo-800 text-sm font-bold border border-gray-200",children:d(t.name,t.userId)}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium hover:text-indigo-600 transition-colors",children:t.name||"User ".concat(t.userId.substring(0,8),"...")}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["Requested ",new Date(t.createdAt).toLocaleString()]})]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:n,disabled:a,className:"p-2 rounded-full bg-green-50 text-green-600 hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Approve request",children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,l.jsx)("polyline",{points:"20 6 9 17 4 12"})})}),(0,l.jsx)("button",{onClick:s,disabled:a,className:"p-2 rounded-full bg-red-50 text-red-600 hover:bg-red-100 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Reject request",children:(0,l.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,l.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,l.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]})},u=()=>{const{eventId:e}=(0,r.g)(),t=(0,r.Zp)(),n=(0,i.n)((e=>e.user));s.useEffect((()=>()=>{}),[e]);const{data:d=[]}=(0,a.nI)(),u=d.find((t=>String(t._id||t.id)===String(e))),{data:m=[],isLoading:x,error:g}=(0,a.nH)(e,{enabled:!!e&&!!n}),h=(0,a.mn)(),p=(0,a.yC)(),f=()=>{t(-1)};return x?(0,l.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,l.jsxs)("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[(0,l.jsx)("button",{onClick:f,className:"mr-4",children:(0,l.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,l.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,l.jsx)("h1",{className:"text-lg font-semibold",children:"Loading..."})]}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})})]}):g?(0,l.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,l.jsxs)("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[(0,l.jsx)("button",{onClick:f,className:"mr-4",children:(0,l.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,l.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,l.jsx)("h1",{className:"text-lg font-semibold",children:"Join Requests"})]}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center text-red-500",children:"Error loading requests. Please try again."})]}):(0,l.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,l.jsxs)("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[(0,l.jsx)("button",{onClick:f,className:"mr-4",children:(0,l.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,l.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),u?(0,l.jsxs)("div",{className:"flex-1 flex items-center justify-between",children:[(0,l.jsx)(o.A,{event:u,onClick:()=>t("/myevents/".concat(e))}),m.length>0&&(0,l.jsx)("span",{className:"ml-2 bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:m.length})]}):(0,l.jsx)("h1",{className:"text-lg font-semibold",children:"Join Requests"})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===m.length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[(0,l.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"mb-4 text-gray-300",children:[(0,l.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,l.jsx)("circle",{cx:"8.5",cy:"7",r:"4"}),(0,l.jsx)("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),(0,l.jsx)("line",{x1:"23",y1:"11",x2:"17",y2:"11"})]}),(0,l.jsx)("p",{children:"No pending join requests"})]}):(0,l.jsx)("div",{className:"divide-y divide-gray-100 bg-white",children:m.map((t=>(0,l.jsx)(c,{request:t,onApprove:()=>{return n=t._id,void h.mutate({eventId:e,requestId:n});var n},onReject:()=>{return n=t._id,void p.mutate({eventId:e,requestId:n});var n},isProcessing:h.isLoading||p.isLoading},t._id)))})})]})}}}]);
//# sourceMappingURL=main~84781932.7af9896c.js.map